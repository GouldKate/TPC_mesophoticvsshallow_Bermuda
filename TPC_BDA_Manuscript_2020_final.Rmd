---
title: "BDA Thermal Performance Curves"
author: "Gould, Katelyn"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    df_print: kable
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
  word_document:
    toc: yes
editor_options:
  chunk_output_type: console
---
# Description
Thermal Performance Curves are fitted to the Sharpe-Schoolfield equation, TPC parameters (E, Eh, Th, lnc, Topt, and Pmax) will be estmated and compared using Anovas and Tukeys HSD tests.
</br>
System:
</br>
At the Bermuda Insitute of Ocean Sciences (funded by  BIOS' "Grant in aid award") in December 2018 respirometry data was collected from 3 genotypes of 4 species of stony coral at two sites North of Bermuda:
</br>
Hog Breaker; 8-10m depth; 32°27’26’N, 64°50’05’W "Shallow"
</br>
Hog Beacon; 30-33m depth; 32°29’18’N, 64°51’18’W "deep"
</br>
Respirometry data consists of change in oxygen (umol/cm2/hr) during:
</br>
Photosynthesis (NP & GP) &
</br>
dark Respiration (R)
</br>
Logging the change in oxygen consumption or production over a 20 min sampling period yielded the metabolic rates used in these analyses.

logged gross photosynthesis (GP) (|NP|+|R|) &
</br>
logged |R| respiration rates

TPC parameters were then estimated and compared:
</br>
No difference in the following TPC parameters between Treatment (depth), species, or treatment*species
</br>
E
</br>
Eh
</br>
Th
</br>
lnc
</br>
Topt

(Tukeys HSD) Differences (p-value <0.05) in Pmax (performance maximums) were found between the following species:
</br>
MCAV-DLAB
PAST-DLAB
OFRA-MCAV
PAST_OFRA
</br>
Pmax did not differ across treatment (depth) 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # will automatically include code in the ouput unless we state otherwise
knitr::opts_chunk$set(warning= FALSE) # will NOT include warning messages in the output unless we state otherwise
# knitr::opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE) #keeps code wrapped in the output

# if you haven't installed these packages run the following line (first delete the # sign):
#install.packages(c("tidyverse", "janitor", "kableExtra", "cowplot", "skimr", "measurements"))

library(tidyverse) #data wrangling & cleaning incl. ggplot
library(janitor) # more data cleaning functions
library(kableExtra) # making pretty tables
library(cowplot) # making publication quality figures or multi-panel figures
library(skimr) # tool to get quick overview of dataset
library(measurements) # useful to convert units
library(magrittr) # magrittr::
library(boot)
library(mime)
library(checkmate)
library(car)
library(curl)
library(nls.multstart)
library(broom) #augment
library(boot)
library(nlstools)
library(proto)
library(nls2)
library(here)
library(lme4)
library(Matrix)
library(lmerTest)
library(stats)
library(Rmisc)
library(purrr) #map
library(Hmisc)
library(FSA)
library(rcompanion)
library(car)

library(multcompView)

library(lsmeans)
library(sjstats)
library(pwr)
library(jtools)
library(ggpubr)
library(multcomp)
library(sjPlot)
library(sjlabelled)
library(sjmisc)
library(ggeffects)


```

# Raw Data {.tabset}
Data consists of metabolic rates for each individuals Net Photosynthesis, Dark Respiration, and Gross Photosynthesis
```{r read in raw data from DataManipulation.R}

raw.data<-read.csv("C:/Github/TPC_BDA_github/R_output/Manuscript/mydata_log.csv")
View(raw.data)
raw.data$X<-NULL
```

## Gross Photosynthesis=[|NP|+|R|]
```{r}
#filterng out NP, removes it from the list 
mydata<-raw.data
mydata<-filter(mydata, rate.type !="NP") 

mydataP<-subset(mydata,rate.type=="GP")
mydataR<-subset(mydata,rate.type=="R")
```

Log rate over inverse temperature linear regression
```{r}

lineardata<-mydata%>%
  filter(rate.type=="GP")
linearR<-mydata%>%
  filter(rate.type=="R")

scatter.smooth(x=(1/lineardata$K), y=lineardata$log.rate) 

scatter.smooth(x=lineardata$K, y=lineardata$log.rate) 

boxplot(lineardata$log.rate, main="GP", sub=paste("Outlier rows: ", boxplot.stats(lineardata$log.rate)$out)) 

# box plot for 'speed'
boxplot(linearR$log.rate, main="R", sub=paste("Outlier rows: ", boxplot.stats(linearR$log.rate)$out))  # box plot for 'distance'



library(e1071)
par(mfrow=c(1, 2))  # divide graph area in 2 columns
plot(density(lineardata$log.rate), main="Density Plot: Rate(GP)", ylab="Frequency", sub=paste("Skewness:", round(e1071::skewness(lineardata$log.rate), 2)))  # density plot for 'speed'
polygon(density(lineardata$log.rate), col="red")

plot(density(linearR$log.rate), main="Density Plot: Rate(R)", ylab="Frequency", sub=paste("Skewness:", round(e1071::skewness(linearR$log.rate), 2)))  # density plot for 'dist'
polygon(density(linearR$log.rate), col="red")
```

## Equation and TPC modelling
Defining the sharpe-schoolfield equation:
```{r}
#Define the Schoolfield equation:
schoolfield_high <- function(lnc, E, Eh, Th, temp, Tc) {
  Tc <- 273.15 + Tc
  k <- 8.62e-5
  boltzmann.term <- lnc + log(exp(E/k*(1/Tc - 1/temp)))
  inactivation.term <- log(1/(1 + exp(Eh/k*(1/Th - 1/temp))))
  return(boltzmann.term + inactivation.term)
}
```

```{r, include=FALSE}
##renameing fragment ID's to represent ALL temperatures
mydata$fragment.ID2<-mydata$individual.ID
```

```{r Subset data for TPC fitting (CIs and fitted), include=FALSE}
#step one subset data: first make subsets for all of your treatment groups 
#-----subset data-------

#by species
DLAB.df<-mydata%>%
  dplyr::filter(species=="DLAB")

MCAV.df<-mydata%>%
  filter(species=="MCAV")

PAST.df<-mydata%>%
  filter(species=="PAST")

OFRA.df<-mydata%>%
  filter(species=="OFRA")

#by Rate.Type
#-------DLAB-------
DLAB.DF.GP<-DLAB.df%>%
  filter(rate.type=="GP")

DLAB.DF.R<-DLAB.df%>%
  filter(rate.type=="R")
#-------MCAV-------
MCAV.DF.GP<-MCAV.df%>%
  filter(rate.type=="GP")

MCAV.DF.R<-MCAV.df%>%
  filter(rate.type=="R")
#-------PAST-------
PAST.DF.GP<-PAST.df%>%
  filter(rate.type=="GP")

PAST.DF.R<-PAST.df%>%
  filter(rate.type=="R")
#-------OFRA-------
OFRA.DF.GP<-OFRA.df%>%
  filter(rate.type=="GP")

OFRA.DF.R<-OFRA.df%>%
  filter(rate.type=="R")

#-finally by treatment
#-------DLAB-------
DLAB.DF.GP.deep<-DLAB.DF.GP%>%
  filter(treatment=="deep")

DLAB.DF.GP.shallow<-DLAB.DF.GP%>%
  filter(treatment=="shallow")

DLAB.DF.R.deep<-DLAB.DF.R%>%
  filter(treatment=="deep")

DLAB.DF.R.shallow<-DLAB.DF.R%>%
  filter(treatment=="shallow")
#-------MCAV-------
MCAV.DF.GP.deep<-MCAV.DF.GP%>%
  filter(treatment=="deep")

MCAV.DF.GP.shallow<-MCAV.DF.GP%>%
  filter(treatment=="shallow")

MCAV.DF.R.deep<-MCAV.DF.R%>%
  filter(treatment=="deep")

MCAV.DF.R.shallow<-MCAV.DF.R%>%
  filter(treatment=="shallow")
#-------PAST-------
PAST.DF.GP.deep<-PAST.DF.GP%>%
  filter(treatment=="deep")

PAST.DF.GP.shallow<-PAST.DF.GP%>%
  filter(treatment=="shallow")

PAST.DF.R.deep<-PAST.DF.R%>%
  filter(treatment=="deep")

PAST.DF.R.shallow<-PAST.DF.R%>%
  filter(treatment=="shallow")
#-------OFRA-------
OFRA.DF.GP.deep<-OFRA.DF.GP%>%
  filter(treatment=="deep")

OFRA.DF.GP.shallow<-OFRA.DF.GP%>%
  filter(treatment=="shallow")

OFRA.DF.R.deep<-OFRA.DF.R%>%
  filter(treatment=="deep")

OFRA.DF.R.shallow<-OFRA.DF.R%>%
  filter(treatment=="shallow")
```

```{r Make function to obratin fitted and CI estimates per genotyope, species, rate type (GP & R), and treatment (site), include=FALSE}
#-------calculate fitted and CI estimates per speciers rate type and treatment-------
#Step one: make empty DF to fill with fitted values and run function
All.fittedT<-data.frame()#create an empty df to fill with fitted values
All.CIT<-data.frame()#create an empty df. to fill with confidence intervals
#
mult.fit.curves<-function(Data){
  fit2 <- nls_multstart(log.rate ~ schoolfield_high(lnc, E, Eh, Th, temp = K, Tc = 27),
                        data = Data,
                        iter = 500,
                        start_lower = c(lnc = -10, E = 0.1, Eh = 0.2, Th = 285),
                        start_upper = c(lnc = 10, E = 2, Eh = 5, Th = 330),
                        supp_errors = 'Y',
                        na.action = na.omit,
                        lower = c(lnc = -10, E = 0, Eh = 0, Th = 0))
print(fit2)
  preds <- augment(fit2)
  Data%<>%
    mutate(fitted=preds$.fitted,
           residuals=preds$.resid)
  
  All.fittedT<<-rbind(All.fittedT,Data)
  
  fit_boots <- Data %>% 
    modelr::bootstrap(n = 500, id = 'boot_num') %>% #change the number for more straps
    group_by(boot_num) %>%
    mutate(fit = map(strap, ~nls_multstart(log.rate ~ schoolfield_high(lnc, E, Eh, Th, temp = K, Tc = 27),
                                           data = data.frame(.),
                                           iter = 500,
                                           start_lower = c(lnc = -10, E = 0.1, Eh = 0.2, Th = 285),
                                           start_upper = c(lnc = 10, E = 2, Eh = 5, Th = 330),
                                           lower = c(lnc=-10, E=0, Eh=0, Th=0),
                                           supp_errors = 'Y')
    ))
  fit_boots
  
  # get predictions
  preds_boot <- fit_boots %>%
    unnest(fit %>% map(augment)) %>%
    ungroup()
  
  new_preds <- Data %>%
    do(., data.frame(K = seq(min(.$K), max(.$K), length.out = 250), stringsAsFactors = FALSE))
  
  preds <- augment(fit2, newdata = new_preds)
  
  df.genotype<-(Data$genotype[1])
  df.rate.type<-(Data$rate.type[1])
  df.treatment<-(Data$treatment[1])
  df.species<-(Data$species[1])
  
  
  preds <- fit_boots %>%
    unnest(fit %>% map(augment, newdata = new_preds)) %>%
    # group by each value of K and get quantiles
    group_by(., K) %>%
    summarise(lwr_CI = quantile(.fitted, 0.025),
              upr_CI = quantile(.fitted, 0.975)) %>%
    ungroup() %>%
    merge(., preds, by.x = "K")%>%
    mutate(genotype=factor(df.genotype),
           treatment=factor(df.treatment),
           rate.type=factor(df.rate.type),
           species=factor(df.species))
  All.CIT<<-rbind(All.CIT, preds)
  
}
```

```{r Fitting Curves, include=FALSE}
#DLAB
mult.fit.curves(DLAB.DF.GP.deep)
mult.fit.curves(DLAB.DF.GP.shallow)
mult.fit.curves(DLAB.DF.R.deep)
mult.fit.curves(DLAB.DF.R.shallow)
#MCAV
mult.fit.curves(MCAV.DF.GP.deep)
mult.fit.curves(MCAV.DF.GP.shallow)
mult.fit.curves(MCAV.DF.R.deep)
mult.fit.curves(MCAV.DF.R.shallow)
#PAST
mult.fit.curves(PAST.DF.GP.deep)
mult.fit.curves(PAST.DF.GP.shallow)
mult.fit.curves(PAST.DF.R.deep)
mult.fit.curves(PAST.DF.R.shallow)
#OFRA
mult.fit.curves(OFRA.DF.GP.deep)
mult.fit.curves(OFRA.DF.GP.shallow)
mult.fit.curves(OFRA.DF.R.deep)
mult.fit.curves(OFRA.DF.R.shallow)

```
# TPC graphs {.tabset}
Varitions on Thermal Performance Graphs
```{r saving and reuploading data.frames, include=FALSE}
#write.csv(All.CIT,"C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/All.CI.csv")
#write.csv(All.fittedT,"C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/All.fitted.csv")
All.CIT<-read.csv("C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/All.CI.csv")
All.fittedT<-read.csv("C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/All.fitted.csv")
```

```{r Group by Site and Rate type- plot TPC, include=FALSE}

All.fittedT%<>%
  mutate(group=factor(paste(treatment,rate.type)))

All.CIT%<>%
  mutate(group=factor(paste(treatment,rate.type)))
```

## TPC1

```{r}
knitr::opts_chunk$set(warning= FALSE)

TPCall<-ggplot() +
  geom_ribbon(data=subset(All.CIT, lwr_CI>0),
              aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedT, aes(x=(K - 273.15), y=log.rate, shape=treatment)) +
  geom_line(data=All.fittedT, aes(x=(K - 273.15), y=fitted, colour=group)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  theme_bw(base_size = 12, base_family = 'Helvetica') +
  facet_wrap(~species)

TPCall
```

## TPC2
```{r}
knitr::opts_chunk$set(warning= FALSE)

STPCall<-ggplot() +
  geom_ribbon(data=subset(All.CIT, lwr_CI>0),
  aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedT, aes(x=(K - 273.15), y=log.rate, shape=treatment)) +
  geom_smooth(data=All.fittedT, aes(x=(K - 273.15), y=fitted, colour=group,se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  theme_bw(base_size = 12, base_family = 'Helvetica') +
scale_color_manual(breaks = c("deepGP", "shallowGP","deepR", "shallowR"), values= c("green4","green1"))+

  facet_wrap(~species)

STPCall
```

## TPC3
```{r}
knitr::opts_chunk$set(warning= FALSE)

TPC<-ggplot() +
  geom_ribbon(data=subset(All.CIT, lwr_CI>0),
  aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedT, aes(x=(K - 273.15), y=log.rate, shape=treatment)) +
  geom_smooth(data=All.fittedT, aes(x=(K - 273.15), y=fitted, colour=group,se=F)) +
  ylab('log Metabolic rate') +
  xlab(c) +
  facet_wrap(~species)+
  theme_classic()+
  labs(title="Thermal Performance Curves Across Depth")

TPC

```

# TPC graphs {.tabset}
```{r TPC by each genotype, include= FALSE}
All.fittedr<-All.fittedT%<>%
  mutate(group=factor(paste(rate.type,species)))

All.CIr<-All.CIT%<>%
  mutate(group=factor(paste(rate.type,species, treatment)))
```

## TPC by Depth
```{r}
knitr::opts_chunk$set(warning= FALSE)

TPCallr<-ggplot() +
  geom_ribbon(data=subset(All.CIr, lwr_CI>0),
  aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedr, aes(x=(K - 273.15), y=log.rate, shape=rate.type)) +
  geom_line(data=All.fittedr, aes(x=(K - 273.15), y=fitted, colour=group)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  theme_bw(base_size = 12, base_family = 'Helvetica') +
  facet_wrap(~treatment)

TPCallr

```


```{r include=FALSE}
TPCr<-ggplot() +
  geom_ribbon(data=subset(All.CIr, lwr_CI>0),
  aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedr, aes(x=(K - 273.15), y=log.rate, shape=rate.type))+ 
  geom_smooth(data=All.fittedr, aes(x=(K - 273.15), y=fitted, colour=group, se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~treatment)+
  theme_classic()+
  labs(title="Thermal Performance Curves Across Depth")

TPCr
```


```{r include=FALSE}

TPCr2<-ggplot() +
  geom_ribbon(data=subset(All.CIr, lwr_CI>0),aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedr, aes(x=(K - 273.15), y=log.rate, shape=species))+ 
  geom_smooth(data=All.fittedr, aes(x=(K - 273.15), y=fitted, colour=group, se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~treatment)+
  theme_classic()+
  labs(title="Thermal Performance Curves Across treatments")

TPCr2
```


```{r TPC by species, include=FALSE}
All.fittedg<-All.fittedT%<>%
  mutate(group=factor(paste(group, species)))

All.CIg<-All.CIT%<>%
  mutate(group=factor(paste(group, species)))

```

```{r ,include=FALSE}

TPCg<-ggplot() +
  geom_ribbon(data=subset(All.CIT, lwr_CI>0),aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedg, aes(x=(K - 273.15), y=log.rate, shape=rate.type))+ 
  geom_smooth(data=All.fittedg, aes(x=(K - 273.15), y=fitted, colour=group, se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~species)+
  theme_classic()
TPCg
```

```{r ,include=FALSE}

TPCg2<-ggplot() +
  geom_ribbon(data=subset(All.CIg, lwr_CI>0),aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedg, aes(x=(K - 273.15), y=log.rate, shape=species))+ 
  geom_smooth(data=All.fittedg, aes(x=(K - 273.15), y=fitted, colour=group, se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~rate.type)+
  theme_classic()

TPCg2
```

```{r ,include=FALSE}

TPCg3<-ggplot() +
  geom_ribbon(data=subset(All.CIg, lwr_CI>0),aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.fittedg, aes(x=(K - 273.15), y=log.rate, shape=species))+ 
  geom_smooth(data=All.fittedg, aes(x=(K - 273.15), y=fitted, colour=group, se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~treatment)+
  theme_classic()
TPCg3
```


```{r ,include=FALSE}

All.GPfit<- subset(All.fittedT, rate.type== "GP")
All.Rfit<-subset(All.fittedT, rate.type== "R")
All.GPCI<-subset(All.CIT, rate.type== "GP")
All.RCI<-subset(All.CIT, rate.type== "R")

All.GPfit<-All.GPfit%<>%
  mutate(group=factor(treatment))

All.GPCI<-All.GPCI%<>%
  mutate(group=factor(treatment))

All.Rfit<-All.Rfit%<>%
  mutate(group=factor(treatment))

All.RCI<-All.RCI%<>%
  mutate(group=factor(treatment))

Smooth<-ggplot() +
  geom_ribbon(data=subset(All.RCI, lwr_CI>0),aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.Rfit, aes(x=(K - 273.15), y=log.rate, shape=species))+ 
  geom_smooth(data=All.Rfit, aes(x=(K - 273.15), y=fitted, colour=group,se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~treatment)+
  theme_classic()

Smooth 

Smooth<-ggplot() +
  geom_ribbon(data=subset(All.GPCI, lwr_CI>0),aes(x=K - 273.15, ymin = lwr_CI, ymax = upr_CI, group=group),fill = 'grey', alpha = .4) +
  geom_point(data=All.GPfit, aes(x=(K - 273.15), y=log.rate, shape=species))+ 
  geom_smooth(data=All.GPfit, aes(x=(K - 273.15), y=fitted, colour=group,se=F)) +
  ylab('log Metabolic rate') +
  xlab('Temperature (ºC)') +
  facet_wrap(~treatment)+
  theme_classic()

Smooth 

```



```{r}
#step one subset data: first make subsets for all of your treatment groups 
#-----subset data-------


#by species
DLAB.df<-mydata%>%
  dplyr::filter(species=="DLAB")

MCAV.df<-mydata%>%
  filter(species=="MCAV")

PAST.df<-mydata%>%
  filter(species=="PAST")

OFRA.df<-mydata%>%
  filter(species=="OFRA")

#by Rate.Type
#-------DLAB-------
DLAB.DF.GP<-DLAB.df%>%
  filter(rate.type=="GP")

DLAB.DF.R<-DLAB.df%>%
  filter(rate.type=="R")
#-------MCAV-------
MCAV.DF.GP<-MCAV.df%>%
  filter(rate.type=="GP")

MCAV.DF.R<-MCAV.df%>%
  filter(rate.type=="R")
#-------PAST-------
PAST.DF.GP<-PAST.df%>%
  filter(rate.type=="GP")

PAST.DF.R<-PAST.df%>%
  filter(rate.type=="R")
#-------OFRA-------
OFRA.DF.GP<-OFRA.df%>%
  filter(rate.type=="GP")

OFRA.DF.R<-OFRA.df%>%
  filter(rate.type=="R")

#-finally by treatment
#-------DLAB-------
DLAB.DF.GP.deep<-DLAB.DF.GP%>%
  filter(treatment=="deep")

DLAB.DF.GP.shallow<-DLAB.DF.GP%>%
  filter(treatment=="shallow")

DLAB.DF.R.deep<-DLAB.DF.R%>%
  filter(treatment=="deep")

DLAB.DF.R.shallow<-DLAB.DF.R%>%
  filter(treatment=="shallow")
#-------MCAV-------
MCAV.DF.GP.deep<-MCAV.DF.GP%>%
  filter(treatment=="deep")

MCAV.DF.GP.shallow<-MCAV.DF.GP%>%
  filter(treatment=="shallow")

MCAV.DF.R.deep<-MCAV.DF.R%>%
  filter(treatment=="deep")

MCAV.DF.R.shallow<-MCAV.DF.R%>%
  filter(treatment=="shallow")
#-------PAST-------
PAST.DF.GP.deep<-PAST.DF.GP%>%
  filter(treatment=="deep")

PAST.DF.GP.shallow<-PAST.DF.GP%>%
  filter(treatment=="shallow")

PAST.DF.R.deep<-PAST.DF.R%>%
  filter(treatment=="deep")

PAST.DF.R.shallow<-PAST.DF.R%>%
  filter(treatment=="shallow")
#-------OFRA-------
OFRA.DF.GP.deep<-OFRA.DF.GP%>%
  filter(treatment=="deep")

OFRA.DF.GP.shallow<-OFRA.DF.GP%>%
  filter(treatment=="shallow")

OFRA.DF.R.deep<-OFRA.DF.R%>%
  filter(treatment=="deep")

OFRA.DF.R.shallow<-OFRA.DF.R%>%
  filter(treatment=="shallow")
```


# All parameters from  data

```{r All parameters with Species, include=FALSE}

#----run this second to get parameters for each genotype
All.parametersS<-data.frame()#create an empty df to fill with calculated parameters


mult.fit.curves2S<-function(Data){
  fit2 <- nls_multstart(log.rate ~ schoolfield_high(lnc, E, Eh, Th, temp = K, Tc = 27),
                        data = Data,
                        iter = 500,
                        start_lower = c(lnc = -10, E = 0.1, Eh = 0.2, Th = 285),
                        start_upper = c(lnc = 10, E = 2, Eh = 5, Th = 330),
                        supp_errors = 'Y',
                        na.action = na.omit,
                        lower = c(lnc = -10, E = 0, Eh = 0, Th = 0))
  #print(fit2)
  params <- tidy(fit2)
  
  params%<>%
    mutate(genotype= Data$genotype[1],
           species= Data$species[1],
           treatment=Data$treatment[1],
           rate.type=Data$rate.type[1],
           fragment.ID2=Data$fragment.ID2[1])
  print(params)
  All.parametersS<<-rbind(params, All.parametersS)
}


```

```{r Subset data again into individual genotypes, include=FALSE}

mult.fit.curves2S(subset(DLAB.DF.GP.deep, genotype=="ML1"))
mult.fit.curves2S(subset(DLAB.DF.GP.deep, genotype=="ML2"))
mult.fit.curves2S(subset(DLAB.DF.GP.deep, genotype=="ML3"))

mult.fit.curves2S(subset(DLAB.DF.GP.shallow, genotype=="SL1"))
mult.fit.curves2S(subset(DLAB.DF.GP.shallow, genotype=="SL2"))
mult.fit.curves2S(subset(DLAB.DF.GP.shallow, genotype=="SL3"))

mult.fit.curves2S(subset(DLAB.DF.R.deep, genotype=="ML1"))
mult.fit.curves2S(subset(DLAB.DF.R.deep, genotype=="ML2"))
mult.fit.curves2S(subset(DLAB.DF.R.deep, genotype=="ML3"))

mult.fit.curves2S(subset(DLAB.DF.R.shallow, genotype=="SL1"))
mult.fit.curves2S(subset(DLAB.DF.R.shallow, genotype=="SL2"))
mult.fit.curves2S(subset(DLAB.DF.R.shallow, genotype=="SL3"))

#MCAVS
mult.fit.curves2S(subset(MCAV.DF.GP.deep, genotype=="MC1"))
mult.fit.curves2S(subset(MCAV.DF.GP.deep, genotype=="MC2"))
mult.fit.curves2S(subset(MCAV.DF.GP.deep, genotype=="MC3"))

mult.fit.curves2S(subset(MCAV.DF.GP.shallow, genotype=="SC1"))
mult.fit.curves2S(subset(MCAV.DF.GP.shallow, genotype=="SC2"))
mult.fit.curves2S(subset(MCAV.DF.GP.shallow, genotype=="SC3"))

mult.fit.curves2S(subset(MCAV.DF.R.deep, genotype=="MC1"))
mult.fit.curves2S(subset(MCAV.DF.R.deep, genotype=="MC2"))
mult.fit.curves2S(subset(MCAV.DF.R.deep, genotype=="MC3"))

mult.fit.curves2S(subset(MCAV.DF.R.shallow, genotype=="SC1"))
mult.fit.curves2S(subset(MCAV.DF.R.shallow, genotype=="SC2"))
mult.fit.curves2S(subset(MCAV.DF.R.shallow, genotype=="SC3"))

#PASTS
mult.fit.curves2S(subset(PAST.DF.GP.deep, genotype=="MA1"))
mult.fit.curves2S(subset(PAST.DF.GP.deep, genotype=="MA2"))
mult.fit.curves2S(subset(PAST.DF.GP.deep, genotype=="MA3"))

mult.fit.curves2S(subset(PAST.DF.GP.shallow, genotype=="SA1"))
mult.fit.curves2S(subset(PAST.DF.GP.shallow, genotype=="SA2"))
mult.fit.curves2S(subset(PAST.DF.GP.shallow, genotype=="SA3"))

mult.fit.curves2S(subset(PAST.DF.R.deep, genotype=="MA1"))
mult.fit.curves2S(subset(PAST.DF.R.deep, genotype=="MA2"))
mult.fit.curves2S(subset(PAST.DF.R.deep, genotype=="MA3"))

mult.fit.curves2S(subset(PAST.DF.R.shallow, genotype=="SA1"))
mult.fit.curves2S(subset(PAST.DF.R.shallow, genotype=="SA2"))
mult.fit.curves2S(subset(PAST.DF.R.shallow, genotype=="SA3"))


#OFRAS
mult.fit.curves2S(subset(OFRA.DF.GP.deep, genotype=="MF1"))
mult.fit.curves2S(subset(OFRA.DF.GP.deep, genotype=="MF2"))
mult.fit.curves2S(subset(OFRA.DF.GP.deep, genotype=="MF3"))

mult.fit.curves2S(subset(OFRA.DF.GP.shallow, genotype=="SF1"))
mult.fit.curves2S(subset(OFRA.DF.GP.shallow, genotype=="SF2"))
mult.fit.curves2S(subset(OFRA.DF.GP.shallow, genotype=="SF3"))

mult.fit.curves2S(subset(OFRA.DF.R.deep, genotype=="MF1"))
mult.fit.curves2S(subset(OFRA.DF.R.deep, genotype=="MF2"))
mult.fit.curves2S(subset(OFRA.DF.R.deep, genotype=="MF3"))

mult.fit.curves2S(subset(OFRA.DF.R.shallow, genotype=="SF1"))
mult.fit.curves2S(subset(OFRA.DF.R.shallow, genotype=="SF2"))
mult.fit.curves2S(subset(OFRA.DF.R.shallow, genotype=="SF3"))

#write.csv(All.parametersS,"C:/Github/TPC_BDA_github/R_output/Manuscript/All.ParametersS2020CI.fitout.csv")

#All.ParametersS<-read.csv("C:/Github/TPC_BDA_github/R_output/Manuscript/All.ParametersS2020CI.fitout.csv")
```

# TPC Parameters across species {.tabset}
Count data for TPC parameters 
```{r Mean parameters including species, include=FALSE}

MeansppParams<-left_join(All.CIT, All.parametersS)

View(MeansppParams)

#C:\Github\TPC_BDA_github\R_output\Manuscript
#write.csv(MeansppParams,"C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/Mean.spp.Params.csv")
#MeansppParams<-read.csv("C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/Mean.spp.Params.csv")

```


```{r Topt for dataframe including species , include=FALSE}
get_topt<-function(E, Th, Eh){
  return((Eh*Th)/(Eh+(8.62e-05*Th*(log((Eh/E))-1))))
}

topt_dataspp<-All.parametersS

topt_dataspp<-All.parametersS%>%
  dplyr::select(fragment.ID2, species, genotype, rate.type, treatment, estimate, term)%>%
  group_by(fragment.ID2, species, genotype, rate.type, treatment)%>%
  spread(term,estimate)

topt_dataspp$topt<-get_topt(E=topt_dataspp$E, Th=topt_dataspp$Th, Eh=topt_dataspp$Eh)

topt_dataspp$topt_C<-topt_dataspp$topt-273.15

topt_dataspp$Th_C<-topt_dataspp$Th-273.15

#C:\Github\TPC_BDA_github\R_output\Manuscript
#write.csv(topt_dataspp,"C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/topt_dataspp.csv")
#topt_dataspp<-read.csv("C:/Github/TPC_BDA_github/R_output/Final/October_RmarkdownFinal/topt_dataspp.csv")

```


# Add Pmax

```{r}

# EXtract Pmax parameter
test<- topt_dataspp %>%
  #select(genotype,  term, estimate, treatment, rate.type) %>%
  #spread(term, estimate) %>%
  mutate(Pmax = schoolfield_high(lnc = lnc, E = E, Th = Th, Eh = Eh, temp = topt, Tc = 27)) %>% #add in factors that make up schoolfield function, reference topt to get pmax
  group_by(., genotype, rate.type, treatment, species, fragment.ID2)

head(test)
str(test)

test$fragment.ID2<-factor(test$fragment.ID2)

# make two DF  for GP and R
testGP<-subset(test, rate.type=="GP")
testR<-subset(test, rate.type=="R")

#remove Inf from Pmax R in testR and make NA's

testR <- lapply(testR, function(x) {
    if(any(is.infinite(x))) {
         x[is.infinite(x)] = NA
    }
    return(x)
})
testR = as.data.frame(testR)
#GP parameter sums
#E
sumE = summarySE(testGP,
                measurevar="E",            groupvars=c("treatment","species"))

sumE



#Eh
sumEh = summarySE(testGP,
                measurevar="Eh",            groupvars=c("treatment","species"))

sumEh

#Th
sumTh = summarySE(testGP,
                measurevar="Th_C",            groupvars=c("treatment","species"))

sumTh
#lnc
sumlnc = summarySE(testGP,
                measurevar="lnc",            groupvars=c("treatment","species"))

sumlnc
#Topt
sumtopt = summarySE(testGPt,
                measurevar="topt_C",            groupvars=c("treatment","species"))

sumtopt
#Pmax
sumpmax = summarySE(testGP, na.rm=TRUE,
                measurevar="Pmax",            groupvars=c("treatment","species"))
sumpmax

### Respiration parameter sums
#E
sumEr = summarySE(testR,
                measurevar="E",            groupvars=c("treatment","species"))

sumEr

sumlogEr = summarySE(testRE,
                measurevar="log.E",            groupvars=c("treatment","species"))

sumlogEr
#Eh
sumEhr = summarySE(testR,
                measurevar="Eh",            groupvars=c("treatment","species"))


#Th
sumThr = summarySE(testR,
                measurevar="Th_C",            groupvars=c("treatment","species"))

sumThr
#lnc
sumlncr = summarySE(testR,
                measurevar="lnc",            groupvars=c("treatment","species"))

sumlncr
#Topt
sumtoptr = summarySE(testR,
                measurevar="topt_C",            groupvars=c("treatment","species"))

sumtoptr

#Pmax
sumpmaxr = summarySE(testR,na.rm=TRUE,
                measurevar="Pmax",            groupvars=c("treatment","species"))
sumpmaxr
##############
sumpmax
sumtopt
sumlnc
sumTh
sumEh
sumE
sumpmaxr
sumtoptr
sumlncr
sumThr
sumEhr
sumEr
sumlogEr
##############
#plot
pd = position_dodge(.2)
theme_set(theme_classic())
#E_GP
ggplot(sumE, aes(x=species,
                y=E,
                color=treatment)) +
    geom_errorbar(aes(ymin=E-se,
                      ymax=E+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Gross Photosynthesis")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))



#stat_compare_means(label.x= "MCAV", label.y=0.75, method = "anova")+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))
 
#Eh_GP
ggplot(sumEh, aes(x=species,
                y=Eh,
                color=treatment)) +
    geom_errorbar(aes(ymin=Eh-se,
                      ymax=Eh+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold"))  +
  ggtitle("Gross Photosynthesis")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#lnc_GP
ggplot(sumlnc, aes(x=species,
                y=lnc,
                color=treatment)) +
    geom_errorbar(aes(ymin=lnc-se,
                      ymax=lnc+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold"))  +
  ggtitle("Gross Photosynthesis")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#Th_GP
ggplot(sumTh, aes(x=species,
                y=Th_C,
                color=treatment)) +
    geom_errorbar(aes(ymin=Th_C-se,
                      ymax=Th_C+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold"))  +
  ggtitle("Gross Photosynthesis")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))


#Topt_GP
ggplot(sumtopt, aes(x=species,
                y=topt_C,
                color=treatment)) +
    geom_errorbar(aes(ymin=topt_C-se,
                      ymax=topt_C+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Gross Photosynthesis")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))
#Pmax

#Pmax_GP
ggplot(sumpmax, aes(x=species,
                y=Pmax,
                color=treatment)) +
    geom_errorbar(aes(ymin=Pmax-se,
                      ymax=Pmax+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Gross Photosynthesis")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#Respiration
#E_R
ggplot(sumEr, aes(x=species,
                y=E,
                color=treatment)) +
    geom_errorbar(aes(ymin=E-se,
                      ymax=E+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#logE_R
ggplot(sumlogEr, aes(x=species,
                y=log.E,
                color=treatment)) +
    geom_errorbar(aes(ymin=log.E-se,
                      ymax=log.E+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#Eh_GP
ggplot(sumEhr, aes(x=species,
                y=Eh,
                color=treatment)) +
    geom_errorbar(aes(ymin=Eh-se,
                      ymax=Eh+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold"))  +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#lnc_GP
ggplot(sumlncr, aes(x=species,
                y=lnc,
                color=treatment)) +
    geom_errorbar(aes(ymin=lnc-se,
                      ymax=lnc+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold"))  +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

#Th_GP
ggplot(sumThr, aes(x=species,
                y=Th_C,
                color=treatment)) +
    geom_errorbar(aes(ymin=Th_C-se,
                      ymax=Th_C+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold"))  +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))


#Topt_GP
ggplot(sumtoptr, aes(x=species,
                y=topt_C,
                color=treatment)) +
    geom_errorbar(aes(ymin=topt_C-se,
                      ymax=topt_C+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))
#Pmax

#Pmax_GP
ggplot(sumpmaxr, aes(x=species,
                y=Pmax,
                color=treatment)) +
    geom_errorbar(aes(ymin=Pmax-se,
                      ymax=Pmax+se),
                   width=.2, size=0.7, position=pd) +
    geom_point(shape=15, size=4, position=pd) +
    theme(
          axis.title.y = element_text(vjust= 1.8),
          axis.title.x = element_text(vjust= -0.5),
          axis.title = element_text(face = "bold")) +
  ggtitle("Respiration")+
  xlab("Species")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

```


log.rate comparisons across species*depth for interaction
```{r}

mydataP<-subset(mydata, rate.type=="GP")
mydataR<-subset(mydata, rate.type=="R")
### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(log.rate~species*treatment,mydataP)
sstable<-Anova(res.aov3, type=2)
sstable
TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]
contrasts
# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstablepmax <- rbind(maineffects, me_contrasts, interaction,  resid)
sstablepmax2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstablepmax$pes <- c(sstablepmax$'Sum Sq'[-nrow(sstablepmax)], NA)/(sstablepmax$'Sum Sq' + sstablepmax$'Sum Sq'[nrow(sstablepmax)]) # SS for each effect divided by the last SS (SS_residual)
sstablepmax

options(knitr.kable.NA = '')

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstablepmax) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstablepmax) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstablepmax) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstablepmax2%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (lograte)
res.aov3<-aov(log.rate~species*treatment*temp.Cat,mydataR)
sstable<-Anova(res.aov3, type=2)
sstable
TukeyHSD(res.aov3)

#MCAV:deep-DLAB:deep
#PAST:deep-DLAB:deep  
#MCAV:shallow-DLAB:deep
#OFRA:deep-MCAV:deep
#DLAB:shallow-MCAV:deep
#OFRA:shallow-MCAV:deep
#PAST:deep-OFRA:deep
#MCAV:shallow-OFRA:deep
#DLAB:shallow-PAST:deep
#OFRA:shallow-PAST:deep
#MCAV:shallow-DLAB:shallow
##PAST:shallow-DLAB:shallow
#OFRA:shallow-MCAV:shallow 
#PAST:shallow-MCAV:shallow 
#PAST:shallow-OFRA:shallow 
#
#DLAB:shallow:36-PAST:deep:19

#,label =  "p.signif"
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

### temp as a random effect
#library(lme4)
#library(lmerTest)
#res.aov32<-lmer(log.rate~species*treatment +(1|temp.Cat),mydataR)
#sstable<-Anova(res.aov32, type=2)
#sstable
#rand(res.aov32)
#
#AIC(res.aov32,res.aov3)
#BIC(res.aov32,res.aov3)
# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstablepmax <- rbind(maineffects, me_contrasts, interaction,  resid)
sstablepmax2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstablepmax$pes <- c(sstablepmax$'Sum Sq'[-nrow(sstablepmax)], NA)/(sstablepmax$'Sum Sq' + sstablepmax$'Sum Sq'[nrow(sstablepmax)]) # SS for each effect divided by the last SS (SS_residual)
sstablepmax

options(knitr.kable.NA = '')

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstablepmax) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstablepmax) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstablepmax2%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F)v
```

log.rate analyses
```{r}
# log.rate comparisons  gross photo



# model
mPGPsp<-aov(log.rate~species*treatment*temp.Cat,mydataP)
summary(mPGPsp)


# log.rate comparisons for respiration

# model
mPGPsp<-aov(log.rate~species*treatment*temp.Cat,mydataR)
summary(mPGPsp)

#
ggline(mydataP, "temp.Cat", "log.rate",color= "species",facet.by="treatment", add=c("mean_se", "dotplot"))
ggline(mydataR, "temp.Cat", "log.rate",color= "species",  facet.by="treatment", add=c("mean_se", "dotplot"))



boxplot(log.rate ~ temp.Cat,  data=mydataP, frame = FALSE)
boxplot(log.rate ~ temp.Cat,  data=mydataR, frame = FALSE)


res.aovagp <- aov(log.rate ~species*treatment*temp.Cat,mydataP)
res.aovar <- aov(log.rate ~ species*treatment*temp.Cat,mydataR)

summary(res.aovagp)
summary(res.aovar)

model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)

TukeyHSD(res.aovagp, which = "species")
TukeyHSD(res.aovar, which = "species")
TukeyHSD(res.aovagp, which = "species:treatment")
TukeyHSD(res.aovar, which =  "species:treatment")


pairwise.t.test(mydataP$log.rate, mydataP$species,
                p.adjust.method = "BH")
pairwise.t.test(mydataR$log.rate, mydataR$species,
                p.adjust.method = "BH")

pairwise.t.test(mydataP$log.rate, mydataP$treatment,
                p.adjust.method = "BH")
pairwise.t.test(mydataR$log.rate, mydataR$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(log.rate ~ species*treatment*temp.Cat, data = mydataP)
leveneTest(log.rate ~ species*treatment*temp.Cat, data = mydataR)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality

plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals

aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals2 )
shapiro.test(x = aov_residuals2r)
```
 
 
log.rate
GP/R
~species*treatment*temp

```{r}

mdP19<-subset(mydataP, temp.Cat=="19")
mdP21<-subset(mydataP, temp.Cat=="21")
mdP23<-subset(mydataP, temp.Cat=="23")
mdP26<-subset(mydataP, temp.Cat=="26")
mdP29<-subset(mydataP, temp.Cat=="29")
mdP32<-subset(mydataP, temp.Cat=="32")
mdP34<-subset(mydataP, temp.Cat=="34")
mdP36<-subset(mydataP, temp.Cat=="36")

mdR19<-subset(mydataR, temp.Cat=="19")
mdR21<-subset(mydataR, temp.Cat=="21")
mdR23<-subset(mydataR, temp.Cat=="23")
mdR26<-subset(mydataR, temp.Cat=="26")
mdR29<-subset(mydataR, temp.Cat=="29")
mdR32<-subset(mydataR, temp.Cat=="32")
mdR34<-subset(mydataR, temp.Cat=="34")
mdR36<-subset(mydataR, temp.Cat=="36")
#gross photo
# models


modlogG19<-aov(log.rate~species*treatment,mdP19)
modlogG21<-aov(log.rate~species*treatment,mdP21)
modlogG23<-aov(log.rate~species*treatment,mdP23)
modlogG26<-aov(log.rate~species*treatment,mdP26)
modlogG29<-aov(log.rate~species*treatment,mdP29)
modlogG32<-aov(log.rate~species*treatment,mdP32)
modlogG34<-aov(log.rate~species*treatment,mdP34)
modlogG36<-aov(log.rate~species*treatment,mdP36)


modlogR19<-aov(log.rate~species*treatment,mdR19)
modlogR21<-aov(log.rate~species*treatment,mdR21)
modlogR23<-aov(log.rate~species*treatment,mdR23)
modlogR26<-aov(log.rate~species*treatment,mdR26)
modlogR29<-aov(log.rate~species*treatment,mdR29)
modlogR32<-aov(log.rate~species*treatment,mdR32)
modlogR34<-aov(log.rate~species*treatment,mdR34)
modlogR36<-aov(log.rate~species*treatment,mdR36)

summary(modlogG19) 
summary(modlogG21)
summary(modlogG23)
summary(modlogG26)
summary(modlogG29)
summary(modlogG32)
summary(modlogG34)
summary(modlogG36)
summary(modlogR19)
summary(modlogR21)
summary(modlogR23)
summary(modlogR26)
summary(modlogR29)
summary(modlogR32)
summary(modlogR34)
summary(modlogR36)

### by treatment

modlogG19<-aov(log.rate~treatment,mdP19)
modlogG21<-aov(log.rate~treatment,mdP21)
modlogG23<-aov(log.rate~treatment,mdP23)
modlogG26<-aov(log.rate~treatment,mdP26)
modlogG29<-aov(log.rate~treatment,mdP29)
modlogG32<-aov(log.rate~treatment,mdP32)
modlogG34<-aov(log.rate~treatment,mdP34)
modlogG36<-aov(log.rate~treatment,mdP36)
modlogR19<-aov(log.rate~treatment,mdR19)
modlogR21<-aov(log.rate~treatment,mdR21)
modlogR23<-aov(log.rate~treatment,mdR23)
modlogR26<-aov(log.rate~treatment,mdR26)
modlogR29<-aov(log.rate~treatment,mdR29)
modlogR32<-aov(log.rate~treatment,mdR32)
modlogR34<-aov(log.rate~treatment,mdR34)
modlogR36<-aov(log.rate~treatment,mdR36)
summary(modlogG19) 
summary(modlogG21) 
summary(modlogG23) 
summary(modlogG26) 
summary(modlogG29) 
summary(modlogG32) 
summary(modlogG34) 
summary(modlogG36) 
summary(modlogR19) 
summary(modlogR21) 
summary(modlogR23) 
summary(modlogR26) 
summary(modlogR29) 
summary(modlogR32) 
summary(modlogR34) 
summary(modlogR36) 

### No sig values across treatments 

## By species

modlogG19<-aov(log.rate~species,mdP19)
modlogG21<-aov(log.rate~species,mdP21)
modlogG23<-aov(log.rate~species,mdP23)
modlogG26<-aov(log.rate~species,mdP26)
modlogG29<-aov(log.rate~species,mdP29)
modlogG32<-aov(log.rate~species,mdP32)
modlogG34<-aov(log.rate~species,mdP34)
modlogG36<-aov(log.rate~species,mdP36)
modlogR19<-aov(log.rate~species,mdR19)
modlogR21<-aov(log.rate~species,mdR21)
modlogR23<-aov(log.rate~species,mdR23)
modlogR26<-aov(log.rate~species,mdR26)
modlogR29<-aov(log.rate~species,mdR29)
modlogR32<-aov(log.rate~species,mdR32)
modlogR34<-aov(log.rate~species,mdR34)
modlogR36<-aov(log.rate~species,mdR36)
summary(modlogG19)##
summary(modlogG21)##
summary(modlogG23)##
summary(modlogG26)
summary(modlogG29)##
summary(modlogG32)
summary(modlogG34)###
summary(modlogG36)##
summary(modlogR19)###
summary(modlogR21)####
summary(modlogR23)##
summary(modlogR26)###
summary(modlogR29)###
summary(modlogR32)###
summary(modlogR34)###
summary(modlogR36)###

#### seperate spp to test across depth
G19D<-subset(mdP19, species== "DLAB")
G21D<-subset(mdP21, species== "DLAB")
G23D<-subset(mdP23, species== "DLAB")
G26D<-subset(mdP26, species== "DLAB")
G29D<-subset(mdP29, species== "DLAB")
G32D<-subset(mdP32, species== "DLAB")
G34D<-subset(mdP34, species== "DLAB")
G36D<-subset(mdP36, species== "DLAB")
R19D<-subset(mdR19, species== "DLAB")
R21D<-subset(mdR21, species== "DLAB")
R23D<-subset(mdR23, species== "DLAB")
R26D<-subset(mdR26, species== "DLAB")
R29D<-subset(mdR29, species== "DLAB")
R32D<-subset(mdR32, species== "DLAB")
R34D<-subset(mdR34, species== "DLAB")
R36D<-subset(mdR36, species== "DLAB")

modlogG19D<-aov(log.rate~treatment,G19D)
modlogG21D<-aov(log.rate~treatment,G21D)
modlogG23D<-aov(log.rate~treatment,G23D)
modlogG26D<-aov(log.rate~treatment,G26D)
modlogG29D<-aov(log.rate~treatment,G29D)
modlogG32D<-aov(log.rate~treatment,G32D)
modlogG34D<-aov(log.rate~treatment,G34D)
modlogG36D<-aov(log.rate~treatment,G36D)
modlogR19D<-aov(log.rate~treatment,R19D)
modlogR21D<-aov(log.rate~treatment,R21D)
modlogR26D<-aov(log.rate~treatment,R26D)
modlogR29D<-aov(log.rate~treatment,R29D)
modlogR32D<-aov(log.rate~treatment,R32D)
modlogR34D<-aov(log.rate~treatment,R34D)
modlogR36D<-aov(log.rate~treatment,R36D)

summary(modlogG19D)#
summary(modlogG21D)
summary(modlogG23D)
summary(modlogG26D)
summary(modlogG29D)
summary(modlogG32D)
summary(modlogG34D)
summary(modlogG36D)
summary(modlogR19D)
summary(modlogR21D)
summary(modlogR23D)#
summary(modlogR26D)
summary(modlogR29D)
summary(modlogR32D)
summary(modlogR34D)
summary(modlogR36D)

### MCAV
G19M<-subset(mdP19, species== "MCAV")
G21M<-subset(mdP21, species== "MCAV")
G23M<-subset(mdP23, species== "MCAV")
G26M<-subset(mdP26, species== "MCAV")
G29M<-subset(mdP29, species== "MCAV")
G32M<-subset(mdP32, species== "MCAV")
G34M<-subset(mdP34, species== "MCAV")
G36M<-subset(mdP36, species== "MCAV")
R19M<-subset(mdR19, species== "MCAV")
R21M<-subset(mdR21, species== "MCAV")
R23M<-subset(mdR23, species== "MCAV")
R26M<-subset(mdR26, species== "MCAV")
R29M<-subset(mdR29, species== "MCAV")
R32M<-subset(mdR32, species== "MCAV")
R34M<-subset(mdR34, species== "MCAV")
R36M<-subset(mdR36, species== "MCAV")

modlogG19M<-aov(log.rate~treatment,G19M)
modlogG21M<-aov(log.rate~treatment,G21M)
modlogG23M<-aov(log.rate~treatment,G23M)
modlogG26M<-aov(log.rate~treatment,G26M)
modlogG29M<-aov(log.rate~treatment,G29M)
modlogG32M<-aov(log.rate~treatment,G32M)
modlogG34M<-aov(log.rate~treatment,G34M)
modlogG36M<-aov(log.rate~treatment,G36M)
modlogR19M<-aov(log.rate~treatment,R19M)
modlogR21M<-aov(log.rate~treatment,R21M)
modlogR23M<-aov(log.rate~treatment,R23M)
modlogR26M<-aov(log.rate~treatment,R26M)
modlogR29M<-aov(log.rate~treatment,R29M)
modlogR32M<-aov(log.rate~treatment,R32M)
modlogR34M<-aov(log.rate~treatment,R34M)
modlogR36M<-aov(log.rate~treatment,R36M)

summary(modlogG19M)#
summary(modlogG21M)
summary(modlogG23M)
summary(modlogG26M)
summary(modlogG29M)
summary(modlogG32M)
summary(modlogG34M)
summary(modlogG36M)
summary(modlogR19M)#
summary(modlogR21M)
summary(modlogR23M)
summary(modlogR26M)
summary(modlogR29M)
summary(modlogR32M)
summary(modlogR34M)
summary(modlogR36M)

### OFRA
G19O<-subset(mdP19, species== "OFRA")
G21O<-subset(mdP21, species== "OFRA")
G23O<-subset(mdP23, species== "OFRA")
G26O<-subset(mdP26, species== "OFRA")
G29O<-subset(mdP29, species== "OFRA")
G32O<-subset(mdP32, species== "OFRA")
G34O<-subset(mdP34, species== "OFRA")
G36O<-subset(mdP36, species== "OFRA")
R19O<-subset(mdR19, species== "OFRA")
R21O<-subset(mdR21, species== "OFRA")
R23O<-subset(mdR23, species== "OFRA")
R26O<-subset(mdR26, species== "OFRA")
R29O<-subset(mdR29, species== "OFRA")
R32O<-subset(mdR32, species== "OFRA")
R34O<-subset(mdR34, species== "OFRA")
R36O<-subset(mdR36, species== "OFRA")

modlogG19O<-aov(log.rate~treatment,G19O)
modlogG21O<-aov(log.rate~treatment,G21O)
modlogG23O<-aov(log.rate~treatment,G23O)
modlogG26O<-aov(log.rate~treatment,G26O)
modlogG29O<-aov(log.rate~treatment,G29O)
modlogG32O<-aov(log.rate~treatment,G32O)
modlogG34O<-aov(log.rate~treatment,G34O)
modlogG36O<-aov(log.rate~treatment,G36O)
modlogR19O<-aov(log.rate~treatment,R19O)
modlogR21O<-aov(log.rate~treatment,R21O)
modlogR23O<-aov(log.rate~treatment,R23O)
modlogR26O<-aov(log.rate~treatment,R26O)
modlogR29O<-aov(log.rate~treatment,R29O)
modlogR32O<-aov(log.rate~treatment,R32O)
modlogR34O<-aov(log.rate~treatment,R34O)
modlogR36O<-aov(log.rate~treatment,R36O)

summary(modlogG19O)
summary(modlogG21O)
summary(modlogG23O)
summary(modlogG26O)
summary(modlogG29O)
summary(modlogG32O)
summary(modlogG34O)#
summary(modlogG36O)
summary(modlogR19O)
summary(modlogR21O)
summary(modlogR23O)
summary(modlogR26O)
summary(modlogR29O)
summary(modlogR32O)
summary(modlogR34O)
summary(modlogR36O)

### PAST
G19P<-subset(mdP19, species== "PAST")
G21P<-subset(mdP21, species== "PAST")
G23P<-subset(mdP23, species== "PAST")
G26P<-subset(mdP26, species== "PAST")
G29P<-subset(mdP29, species== "PAST")
G32P<-subset(mdP32, species== "PAST")
G34P<-subset(mdP34, species== "PAST")
G36P<-subset(mdP36, species== "PAST")
R19P<-subset(mdR19, species== "PAST")
R21P<-subset(mdR21, species== "PAST")
R23P<-subset(mdR23, species== "PAST")
R26P<-subset(mdR26, species== "PAST")
R29P<-subset(mdR29, species== "PAST")
R32P<-subset(mdR32, species== "PAST")
R34P<-subset(mdR34, species== "PAST")
R36P<-subset(mdR36, species== "PAST")

modlogG19P<-aov(log.rate~treatment,G19P)
modlogG21P<-aov(log.rate~treatment,G21P)
modlogG23P<-aov(log.rate~treatment,G23P)
modlogG26P<-aov(log.rate~treatment,G26P)
modlogG29P<-aov(log.rate~treatment,G29P)
modlogG32P<-aov(log.rate~treatment,G32P)
modlogG34P<-aov(log.rate~treatment,G34P)
modlogG36P<-aov(log.rate~treatment,G36P)
modlogR19P<-aov(log.rate~treatment,R19P)
modlogR21P<-aov(log.rate~treatment,R21P)
modlogR23P<-aov(log.rate~treatment,R23P)
modlogR26P<-aov(log.rate~treatment,R26P)
modlogR29P<-aov(log.rate~treatment,R29P)
modlogR32P<-aov(log.rate~treatment,R32P)
modlogR34P<-aov(log.rate~treatment,R34P)
modlogR36P<-aov(log.rate~treatment,R36P)

summary(modlogG19P)
summary(modlogG21P)
summary(modlogG23P)
summary(modlogG26P)
summary(modlogG29P)
summary(modlogG32P)
summary(modlogG34P)
summary(modlogG36P)
summary(modlogR19P)
summary(modlogR21P)
summary(modlogR23P)
summary(modlogR26P)
summary(modlogR29P)
summary(modlogR32P)#
summary(modlogR34P)
summary(modlogR36P)

```

by speices log.rate graphs across treatments
```{r}
####### 23 is done- follow start with 19D change to make graphs for all treatment log.rate differences across temperature
####### 
modlogG19D<-lm(log.rate~treatment,G19D)
Anova(modlogG19D)

summ(modlogG19D, confint = TRUE, digits = 1)

gGP19D <- as.data.frame(summary(modlogG19D)$coefficients)
gGP19D
names(gGP19D)[2] = "se" 
coral <- c(treatmentshallow="")
gGP19D$vars = coral
gGP19D<-gGP19D[-1,]

gGP19DP<-ggplot(gGP19D, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="#003300", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="#33FF33", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('DLAB GP 19ºC ')
gGP19DP
ggexport(gGP19DP, filename = "gGP19DP.pdf")


#####
modlogR23D<-lm(log.rate~treatment,R23D)
Anova(modlogR23D)

summ(modlogR23D, confint = TRUE, digits = 1)

R23DR <- as.data.frame(summary(modlogR23D)$coefficients)
R23DR
names(R23DR)[2] = "se" 
coral <- c(treatmentshallow="")
R23DR$vars = coral
R23DR<-R23DR[-1,]

R23DRP<-ggplot(R23DR, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="#003366", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="#00CCFF", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('DLAB R 23ºC')
R23DRP
ggexport(R23DRP, filename = "R23DRP.pdf")

#######
modlogR19M<-lm(log.rate~treatment,R19M)
Anova(modlogR19M)

summ(modlogR19M, confint = TRUE, digits = 1)

R19MR <- as.data.frame(summary(modlogR19M)$coefficients)
R19MR
names(R19MR)[2] = "se" 
coral <- c(treatmentshallow="")
R19MR$vars = coral
R19MR<-R19MR[-1,]

R19MRP<-ggplot(R19MR, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="#003366", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="#00CCFF", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('MCAV R 21ºC')
R19MRP
ggexport(R19MRP, filename = "R19MRP.pdf")

######

modlogG34O<-lm(log.rate~treatment,G34O)
Anova(modlogG34O)

summ(modlogG34O, confint = TRUE, digits = 1)

G34OP <- as.data.frame(summary(modlogG34O)$coefficients)
G34OP
names(G34OP)[2] = "se" 
coral <- c(treatmentshallow="")
G34OP$vars = coral
G34OP<-G34OP[-1,]

G34OPP<-ggplot(G34OP, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="#003300", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="#33FF33", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('OFRA GP 34ºC')
G34OPP


ggexport(G34OPP, filename = "G34OPP.pdf")

########
modlogG19M<-lm(log.rate~treatment,G19M)
Anova(modlogG19M)

summ(modlogG19M, confint = TRUE, digits = 1)

G19MP <- as.data.frame(summary(modlogG19M)$coefficients)
G19MP
names(G19MP)[2] = "se" 
coral <- c(treatmentshallow="")
G19MP$vars = coral
G19MP<-G19MP[-1,]

G19MPP<-ggplot(G19MP, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="#003300", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="#33FF33", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('MCAV GP 19ºC')
G19MPP

ggexport(G19MPP, filename = "G19MPP.pdf")

##############
modlogR32P<-lm(log.rate~treatment,R32P)
Anova(modlogR32P)

summ(modlogR32P, confint = TRUE, digits = 1)

R32PR <- as.data.frame(summary(modlogR32P)$coefficients)
R32PR
names(R32PR)[2] = "se" 
coral <- c(treatmentshallow="")
R32PR$vars = coral
R32PR<-R32PR[-1,]

R32PRP<-ggplot(R32PR, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="#003366", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="#00CCFF", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('PAST R 32ºC')
R32PRP


ggexport(R32PRP, filename = "R32PRP.pdf")

#####################

```


log.rate graphs
```{r}

theme_set(theme_sjplot())
## Respiration:
fit<-lm(log.rate~species*treatment*temp.Cat ,mydataR)
summary(fit)
Anova(fit)

plot(fit)
plot_model(fit,sort.est = TRUE)


plot_model(fit, type = "pred", terms = c("temp.Cat", "treatment", "species"))
plot_model(fit, type = "pred", terms = c("species", "temp.Cat", "treatment"), dodge= 1)
plot_model(fit, type = "pred", terms = c("treatment", "temp.Cat", "species"),dodge= 1)

plot_model(fit, type = "int", mdrt.values = "meansd")
plot_model(fit, type = "pred", terms = c("species", "temp.Cat[19,26,36]", "treatment"),dodge= 1)
plot_model(fit, type = "pred", terms = c( "treatment", "temp.Cat[19,26,36]"),dodge= 1)
plot_model(fit, type = "int")
           
logR<- ggplot(mydataR, aes(x=species, log.rate, colour= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  ggtitle("")+
  stat_compare_means(aes(group=treatment),label.x= "deep", label.y=1.1, method = "anova")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("green4","green1"))
logR


logR<- ggplot(mydataR, aes(x=treatment, log.rate, colour= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  ggtitle("")+
  stat_compare_means(aes(group=treatment),label.x= "deep", label.y=1.1, method = "anova")+scale_color_manual(breaks = c("deep", "shallow"), values= c("green4","green1"))+
  facet_wrap("species")

logR

logR<- ggplot(mydataR, aes(x=temp.Cat, log.rate, colour= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  ggtitle("")+
  stat_compare_means(aes(group=treatment),label.x= "deep", label.y=1.1, method = "anova")+scale_color_manual(breaks = c("deep", "shallow"), values= c("green4","green1"))+
  facet_wrap("species")

logR

#Fig 4.
sppPmax<- ggplot(RE, aes(x=treatment, E, colour= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,45)+
  xlab(NULL)+
  ylab('Energy')+
  ggtitle("E")+
  stat_compare_means(label.x= "deep", label.y=40, method = "kruskal")+scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))

sppPmax
##### all temps 
#logR<- ggplot(mydataR, aes(x=treatment, log.rate, colour= treatment))+
#  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
#  geom_boxplot(position = position_dodge(1))+
#  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, #jitter.height = 0))+
#  guides(fill= guide_legend(override.aes = list(shape= NA)))+
#  theme_classic()+
#  xlab(NULL)+
#  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
#  ggtitle("")+
#  stat_compare_means(aes(group=species),label.x= "deep", label.y=1.1, method = "anova")+
#  scale_color_manual(breaks = c("deep", "shallow"), values= c("blue4","blue1"))
#logR

## subset temps to show the log.rate
## log.dataGross photosynthesis
theme_set(theme_sjplot())
## GP
fit<-lm(log.rate~species*treatment*temp.Cat ,mydataP)
summary(fit)
Anova(fit)

plot_model(fit, type = "pred", terms = c("temp.Cat", "treatment", "species"))
plot_model(fit, type = "pred", terms = c("species", "temp.Cat", "treatment"))
plot_model(fit, type = "pred", terms = c("treatment", "temp.Cat", "species"))

plot_model(fit, type = "int", mdrt.values = "meansd")
plot_model(fit, type = "pred", terms = c("species", "temp.Cat[19,26,36]", "treatment"))
plot_model(fit, type = "pred", terms = c( "treatment", "temp.Cat[19,26,36]"))
plot_model(fit, type = "int")

logGP<- ggplot(mydataP, aes(x=species, log.rate, colour= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  ggtitle("")+
  stat_compare_means(aes(group=treatment),label.x= "deep", label.y=1.1, method = "anova")+
  scale_color_manual(breaks = c("deep", "shallow"), values= c("green4","green1"))
logGP


logGP<- ggplot(mydataP, aes(x=treatment, log.rate, colour= treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= treatment, shape=species, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  ggtitle("")+
  stat_compare_means(aes(group=treatment),label.x= "deep", label.y=1.1, method = "anova")+scale_color_manual(breaks = c("deep", "shallow"), values= c("green4","green1"))+
  facet_wrap("species")

logGP


#Figure 3.
```


Pmax 
GP/R
~species*treatment
testGP
testR
```{r}
### 
mPGPsp<-lm(Pmax~species*treatment,testGP)
summary(mPGPsp)
mPGPsp2<-aov(Pmax~species*treatment,testGP)
summary(mPGPsp2)
anova(mPGPsp)
anova(mPGPsp2)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

testGPP<-testGP
mPGPsp<-aov(Pmax~species*treatment, testGPP)
summary(mPGPsp)

# Pmax comparisons between all  species for respiration


# model
mPGPsp<-aov(Pmax~species*treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
# no outliers but 3 NaNs

######
######
ggline(testGPP, "species", "Pmax",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testR, "species", "Pmax",color= "treatment", add=c("mean_se", "dotplot"))

boxplot(Pmax ~ species * treatment, data=testGPP, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="Pmax")

boxplot(Pmax ~ species * treatment, data=testR, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="Pmax")

interaction.plot(x.factor = testGPP$species, trace.factor = testGPP$treatment, 
                 response = testGPP$Pmax, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="Pmax")

interaction.plot(x.factor = testR$species, trace.factor = testR$treatment, 
                 response = testR$Pmax, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="Pmax")


res.aov2 <- aov(Pmax ~ species + treatment, data = testGP)
res.aov2r <- aov(Pmax ~ species + treatment, data = testR)
res.aov3 <- aov(Pmax ~ species * treatment, data = testGPP)
res.aov3r <- aov(Pmax~ species * treatment, data = testR)


summary(res.aov2)#species
summary(res.aov2r)#species
summary(res.aov3) #species
summary(res.aov3r)#none
model.tables(res.aov2, type="means", se= TRUE)
model.tables(res.aov2r, type="means", se= TRUE)
model.tables(res.aov3, type="means", se= TRUE)
model.tables(res.aov3r, type="means", se= TRUE)
TukeyHSD(res.aov2)
TukeyHSD(res.aov2r)
TukeyHSD(res.aov3)
TukeyHSD(res.aov3r)
         

pairwise.t.test(testGPP$Pmax, testGPP$species,
                p.adjust.method = "BH")
pairwise.t.test(testR$Pmax, testR$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aov2, 1) #outliers 1,2,6
plot(res.aov2r, 1) #5, 23, 19
plot(res.aov3r, 1) #5, 6, 19
plot(res.aov3, 1) #outliers 1, 6 2
leveneTest(Pmax ~ species* treatment, data = testGPP)
leveneTest(Pmax ~ species* treatment, data = testR)
#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aov2, 2)
plot(res.aov2r, 2)
plot(res.aov3, 2)
plot(res.aov3r, 2)

# Extract the residuals
aov_residuals2 <- residuals(object = res.aov2)
aov_residuals2r <- residuals(object = res.aov2r)
aov_residuals3 <- residuals(object = res.aov3)
aov_residuals3r <- residuals(object = res.aov3r)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals2 )
shapiro.test(x = aov_residuals2r)
shapiro.test(x = aov_residuals3 )
shapiro.test(x = aov_residuals3r )

### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(Pmax~species*treatment,testGPP)
sstable<-Anova(res.aov3, type=2)
sstable
TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstablepmax <- rbind(maineffects, me_contrasts, interaction,  resid)
sstablepmax2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstablepmax 
sstablepmax2

sstablepmax$pes <- c(sstablepmax$'Sum Sq'[-nrow(sstablepmax)], NA)/(sstablepmax$'Sum Sq' + sstablepmax$'Sum Sq'[nrow(sstablepmax)]) # SS for each effect divided by the last SS (SS_residual)
sstablepmax

write.csv(sstablepmax, "C:/Github/TPC_BDA_github/PmaxgpinPval.csv")

options(knitr.kable.NA = '')

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstablepmax) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstablepmax) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstablepmax) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstablepmax2%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (Pmax)
res.aov3<-aov(Pmax~species*treatment,testR)
sstable<-Anova(res.aov3, type=2)
sstable
TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstablepmax <- rbind(maineffects, me_contrasts, interaction,  resid)
sstablepmax2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstablepmax$pes <- c(sstablepmax$'Sum Sq'[-nrow(sstablepmax)], NA)/(sstablepmax$'Sum Sq' + sstablepmax$'Sum Sq'[nrow(sstablepmax)]) # SS for each effect divided by the last SS (SS_residual)

View(sstablepmax)
write.csv(sstablepmax, "C:/Github/TPC_BDA_github/PmaxrinPval.csv")

options(knitr.kable.NA = '')

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstablepmax) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstablepmax) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstablepmax%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstablepmax2%>% 
    # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Pmax Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 
```

Pmax models across species
No difference in Pmax between GP deep GP shallow R deep
Difference between species in only shallow respiration
```{r}

## Pmax comparisons between deep species for Gross Photo
##Deep
#DeepsppGP
#
#
## model
#mPGPsp<-aov(Pmax~species,DeepsppGP)
#summary(mPGPsp) #p-value 0.0754
### check for outliers
#cooksd <- cooks.distance(mPGPsp)
#plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
#abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s #distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
#text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, #col="red")
#
##No outliers
#
## Pmax comparisons between shallow species for Gross Photo
##Shallow
#ShaowspGP
#
## model
#mPGPsp<-aov(Pmax~species,ShaowspGP)
#summary(mPGPsp)
#
### check for outliers
#cooksd <- cooks.distance(mPGPsp)
#plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
#abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s #distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
#text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, #col="red")
#
##No outliers
#
#
## Pmax comparisons between deep species for respiration
##Deep
#DeepsppR
#
## model
#mPGPsp<-aov(Pmax~species,DeepsppR)
#summary(mPGPsp)
#
### check for outliers
#cooksd <- cooks.distance(mPGPsp)
#plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
#abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s #distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
#text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, #col="red")
#
##No outliers
#
## Pmax comparisons between shallow  species for respiration
##Shallow
#ShaowspR
#
## model
#mPGPsp<-aov(Pmax~species, ShaowspR)
#summary(mPGPsp)
#
### check for outliers
#cooksd <- cooks.distance(mPGPsp)
#plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
#abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s #distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
#text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, #col="red")

#No outliers
# model
mPGPsp<-aov(Pmax~species, testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#use testGPP
mPGPsp<-aov(Pmax~species, testGPP)
summary(mPGPsp)

# model
mPGPsp<-aov(Pmax~species, testR)
summary(mPGPsp)


ggline(testGPP, "species", "Pmax",color= "species", add=c("mean_se", "dotplot"))
ggline(testR, "species", "Pmax",color= "species", add=c("mean_se", "dotplot"))


#boxplot(Pmax ~ species, data=DeepsppGP, frame = FALSE, 
#        col = c("orange", "green", "purple", "blue"), ylab="Pmax")
#boxplot(Pmax ~ species , data=DeepsppR, frame = FALSE, 
#        col = c("orange", "green", "purple", "blue"), ylab="Pmax")
#boxplot(Pmax ~ species, data=ShaowspGP, frame = FALSE, 
#        col = c("orange", "green", "purple", "blue"), ylab="Pmax")
#boxplot(Pmax ~ species, data=ShaowspR, frame = FALSE, 
#        col = c("orange", "green", "purple", "blue"), ylab="Pmax")

boxplot(Pmax ~ species, data=testGPP, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="Pmax")

boxplot(Pmax ~ species, data=testRP, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="Pmax")

#res.aov2 <- aov(Pmax ~ species,  data = DeepsppGP)
#res.aov2r <- aov(Pmax ~ species, data = DeepsppR)
#res.aov3 <- aov(Pmax ~ species, data = ShaowspGP)
#res.aov3r <- aov(Pmax ~ species, data = ShaowspR)
res.aovagp <- aov(Pmax ~ species, data = testGPP)
res.aovar <- aov(Pmax ~ species, data = testRP)
#summary(res.aov2)
#summary(res.aov2r)
#summary(res.aov3) ##
#summary(res.aov3r)
summary(res.aovagp)
summary(res.aovar)

#model.tables(res.aov2, type="means", se= TRUE)
#model.tables(res.aov2r, type="means", se= TRUE)
#model.tables(res.aov3, type="means", se= TRUE)
#model.tables(res.aov3r, type="means", se= TRUE)
model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)

#TukeyHSD(res.aov2, which = "species") 
#TukeyHSD(res.aov2r, which = "species")
#TukeyHSD(res.aov3, which = "species") #ShaowspR MCAV-DLAB, PAST-DLAB,OFRA-MCAV, PAST-OFRA
#TukeyHSD(res.aov3r, which = "species")
TukeyHSD(res.aovagp, which = "species")
TukeyHSD(res.aovar, which = "species")

#summary(glht(res.aov2, linfct = mcp(species = "Tukey")))
#summary(glht(res.aov2r, linfct = mcp(species = "Tukey")))
#summary(glht(res.aov3, linfct = mcp(species = "Tukey")))
#summary(glht(res.aov3r, linfct = mcp(species = "Tukey")))
summary(glht(res.aovagp, linfct = mcp(species = "Tukey")))
summary(glht(res.aovar, linfct = mcp(species = "Tukey")))

#pairwise.t.test(DeepsppGP$Pmax, DeepsppGP$species,
#                p.adjust.method = "BH")
#pairwise.t.test(DeepsppR$Pmax, DeepsppR$species,
#                p.adjust.method = "BH")
#pairwise.t.test(ShaowspGP$Pmax, ShaowspGP$species,
#                p.adjust.method = "BH")
#pairwise.t.test(ShaowspR$Pmax, ShaowspR$species,
              #  p.adjust.method = "BH")
pairwise.t.test(testGPP$Pmax, testGPP$species,
                p.adjust.method = "BH")
pairwise.t.test(testRP$Pmax, testRP$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
#plot(res.aov2, 1) #1,2,6
#plot(res.aov2r, 1) #1, 5, 6
#plot(res.aov3r, 1) #18,19,23
#plot(res.aov3, 1) # 4, 8 ,10
plot(res.aovagp, 1)
plot(res.aovar, 1)
#leveneTest(Pmax ~ species, data = DeepsppGP)
#leveneTest(Pmax ~ species, data = DeepsppR)
#leveneTest(Pmax ~ species, data = ShaowspGP)
#leveneTest(Pmax ~ species, data = ShaowspR)
leveneTest(Pmax ~ species, data = testGPP)
leveneTest(Pmax ~ species, data = testRP)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
#plot(res.aov2, 2)
#plot(res.aov2r, 2)
#plot(res.aov3, 2)
#plot(res.aov3r, 2)
plot(res.aovagp, 2)
plot(res.aovar, 2)
## Extract the residuals
#aov_residuals2 <- residuals(object = res.aov2)
#aov_residuals2r <- residuals(object = res.aov2r)
#aov_residuals3 <- residuals(object = res.aov3)
#aov_residuals3r <- residuals(object = res.aov3r)
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test
#shapiro.test(x = aov_residuals2 )
#shapiro.test(x = aov_residuals2r)
#shapiro.test(x = aov_residuals3 )
#shapiro.test(x = aov_residuals3r )
shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )

```
Pmax
GP/R
~treatment


Pmax by treatment
```{r}
# Pmax by treatment

# GP treatment


# model
mPGPsp<-aov(Pmax~treatment,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# Pmax comparisons between  treatment for respiration

# model
mPGPsp<-aov(Pmax~treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#No outliers

#### Test spp individually by depth
#### subsetdatabases testR and testGP
DtestR<-subset(testR, species=="DLAB")
MtestR<-subset(testR, species=="MCAV")
OtestR<-subset(testR, species=="OFRA")
PtestR<-subset(testR, species=="PAST")
DtestGP<-subset(testGP, species=="DLAB")
MtestGP<-subset(testGP, species=="MCAV")
OtestGP<-subset(testGP, species=="OFRA")
PtestGP<-subset(testGP, species=="PAST")
#DLABGP

mPGPsp<-aov(Pmax~treatment, DtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#DLABR

mPGPsp<-aov(Pmax~treatment, DtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#MCAV R

mPGPsp<-aov(Pmax~treatment, MtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#MCAVGP

mPGPsp<-aov(Pmax~treatment, MtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#OFRAR

mPGPsp<-aov(Pmax~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#OFRAGP

mPGPsp<-aov(Pmax~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#PASTR

mPGPsp<-aov(Pmax~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#PASTGP

mPGPsp<-aov(Pmax~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")





ggline(testGP, "treatment", "Pmax",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testR, "treatment", "Pmax",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(Pmax ~ treatment, data=testGP, frame = FALSE, 
        col = c("green4", "green1"), ylab="Pmax")

boxplot(Pmax ~ treatment, data=testR, frame = FALSE, 
        col = c("blue4", "blue1"), ylab="Pmax")


res.aovagp <- aov(Pmax ~ treatment, data = testGP)
res.aovar <- aov(Pmax ~ treatment, data = testR)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "treatment")
#TukeyHSD(res.aovar, which = "treatment")


#summary(glht(res.aovagp, linfct = mcp(treatment = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(treatment = "Tukey")))

pairwise.t.test(testGP$Pmax, testGP$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testR$Pmax, testR$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(Pmax ~ treatment, data = testGP)
leveneTest(Pmax ~ treatment, data = testR)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )

###
kruskal.test(Pmax~treatment,testGP)

### log parameter Th_C GP- failed shapiro
testGP$log.Pmax <- log(testGP$Pmax+ 1) 

mPGPsp<-aov(log.Pmax~treatment,testGP)
summary(mPGPsp)
## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#no outliers
mPGPsp<-aov(log.Pmax~treatment,testGP)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.Pmax~treatment, testGP) 

```



topt_C 
GP/R
~species*treatment
testGPt
testRt
```{r}


#gross photo
# model
mPGPsp<-aov(topt_C~species*treatment,testGP)
summary(mPGPsp) 
## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 10 13 ML1 and SA1
testGPt<-testGP[-c(10,13),]

mPGPsp<-aov(topt_C~species*treatment, testGPt)
summary(mPGPsp)

# model
mPGPsp<-aov(topt_C~species*treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 3, 7, 11 MA3 MF1 ML2
testRt<-testR[-c(3,7,11),]

mPGPsp<-aov(topt_C~species*treatment, testRt)
summary(mPGPsp)


ggline(testGPt, "species", "topt_C",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRt, "species", "topt_C",color= "treatment", add=c("mean_se", "dotplot"))


boxplot(topt_C ~ species * treatment, data=testGPt, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="topt_C")

boxplot(topt_C ~ species * treatment, data=testRt, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="topt_C")

interaction.plot(x.factor = testGPt$species, trace.factor = testGPt$treatment, 
                 response = testGPt$topt_C, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="topt_C")

interaction.plot(x.factor = testRt$species, trace.factor = testRt$treatment, 
                 response = testRt$topt_C, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="topt_C")


res.aov3 <- aov(topt_C ~ species * treatment, data = testGPt)
res.aov3r <- aov(topt_C~ species * treatment, data = testRt)


summary(res.aov3) 
summary(res.aov3r)

model.tables(res.aov3, type="means", se= TRUE)
model.tables(res.aov3r, type="means", se= TRUE)

TukeyHSD(res.aov3)
TukeyHSD(res.aov3r)

TukeyHSD(res.aov3, which = "species") 
TukeyHSD(res.aov3r, which = "species")

summary(glht(res.aov3, linfct = mcp(species = "Tukey")))
summary(glht(res.aov3r, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPt$topt_C, testGPt$species,
                p.adjust.method = "BH")
pairwise.t.test(testRt$topt_C, testRt$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aov3, 1) 
plot(res.aov3r, 1)
leveneTest(topt_C ~ species* treatment, data = testGPt)
leveneTest(topt_C ~ species* treatment, data = testRt)
#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality

plot(res.aov3, 2)
plot(res.aov3r, 2)

# Extract the residuals
aov_residuals3 <- residuals(object = res.aov3)
aov_residuals3r <- residuals(object = res.aov3r)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals3 )
shapiro.test(x = aov_residuals3r )

### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(topt_C~species*treatment,testGPt)
sstable<-Anova(res.aov3, type=2)
sstable
write.csv(sstable, "C:/Github/TPC_BDA_github/ToptGPinPval.csv")

TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstabletopt_C <- rbind(maineffects, me_contrasts, interaction,  resid)
sstabletopt_C2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstabletopt_C$pes <- c(sstabletopt_C$'Sum Sq'[-nrow(sstabletopt_C)], NA)/(sstabletopt_C$'Sum Sq' + sstabletopt_C$'Sum Sq'[nrow(sstabletopt_C)]) # SS for each effect divided by the last SS (SS_residual)
View(sstabletopt_C)

options(knitr.kable.NA = '')

sstabletopt_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova topt_C Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstabletopt_C) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstabletopt_C) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstabletopt_C) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstabletopt_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova topt_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstabletopt_C2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova topt_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (topt_C)
res.aov3<-aov(topt_C~species*treatment,testRt)
sstable<-Anova(res.aov3, type=2)
sstable
write.csv(sstable, "C:/Github/TPC_BDA_github/ToptrinPval.csv")

TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstabletopt_C <- rbind(maineffects, me_contrasts, interaction,  resid)
sstabletopt_C2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstabletopt_C$pes <- c(sstabletopt_C$'Sum Sq'[-nrow(sstabletopt_C)], NA)/(sstabletopt_C$'Sum Sq' + sstabletopt_C$'Sum Sq'[nrow(sstabletopt_C)]) # SS for each effect divided by the last SS (SS_residual)
sstabletopt_C

options(knitr.kable.NA = '')

sstabletopt_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova topt_C Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstabletopt_C) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstabletopt_C) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstabletopt_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova topt_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstabletopt_C2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova topt_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 
```


Topt by species
```{r}
# Topt by species

# GP species


# model
mPGPsp<-aov(topt_C~species,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#use testGPt
mPGPsp<-aov(topt_C~species,testGPt)
summary(mPGPsp)

# topt_C comparisons between  species for respiration

# model
mPGPsp<-aov(topt_C~species, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#use testRt
# 3 7 11
mPGPsp<-aov(topt_C~species, testRt)
summary(mPGPsp)

#

ggline(testGPt, "species", "topt_C",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRt, "species", "topt_C",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(topt_C ~ species, data=testGPt, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="topt_C")

boxplot(topt_C ~ species, data=testRt, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="topt_C")


res.aovagp <- aov(topt_C ~ species, data = testGPt)
res.aovar <- aov(topt_C ~ species, data = testRt)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "species")
#TukeyHSD(res.aovar, which = "species")


#summary(glht(res.aovagp, linfct = mcp(species = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPt$topt_C, testGPt$species,
                p.adjust.method = "BH")
pairwise.t.test(testRt$topt_C, testRt$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(topt_C ~ species, data = testGPt)
leveneTest(topt_C ~ species, data = testRt)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )
```


topt_C by treatment
```{r}
# topt_C by treatment

# GP treatment


# model
mPGPsp<-aov(topt_C~treatment,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#use testGPt
mPGPsp<-aov(topt_C~treatment,testGPt)
summary(mPGPsp)


# topt_C comparisons between  treatment for respiration

# model
mPGPsp<-aov(topt_C~treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#3 7 11
#use testRt
mPGPsp<-aov(topt_C~treatment,testRt)
summary(mPGPsp)

#### Depth by individual species

#DLABGP

mPGPsp<-aov(topt_C~treatment, DtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#DLABR

mPGPsp<-aov(topt_C~treatment, DtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#MCAV R

mPGPsp<-aov(topt_C~treatment, MtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#MCAVGP

mPGPsp<-aov(topt_C~treatment, MtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#OFRAR

mPGPsp<-aov(topt_C~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#OFRAGP

mPGPsp<-aov(topt_C~treatment, OtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#PASTR

mPGPsp<-aov(topt_C~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#PASTGP

mPGPsp<-aov(topt_C~treatment, PtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#

ggline(testGPt, "treatment", "topt_C",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRt, "treatment", "topt_C",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(topt_C ~ treatment, data=testGPt, frame = FALSE, 
        col = c("green4", "green1"), ylab="topt_C")

boxplot(topt_C ~ treatment, data=testRt, frame = FALSE, 
        col = c("blue4", "blue1"), ylab="topt_C")


res.aovagp <- aov(topt_C ~ treatment, data = testGPt)
res.aovar <- aov(topt_C ~ treatment, data = testRt)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "treatment")
#TukeyHSD(res.aovar, which = "treatment")


#summary(glht(res.aovagp, linfct = mcp(treatment = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(treatment = "Tukey")))

pairwise.t.test(testGPt$topt_C, testGPt$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testRt$topt_C, testRt$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(topt_C ~ treatment, data = testGPt)
leveneTest(topt_C ~ treatment, data = testRt)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
## Not normal
# log topt_C for respiration

# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )

###
kruskal.test(topt_C~treatment,testRt)


sumpmaxtopt = summarySE(testGPt, na.rm=TRUE,measurevar="topt_C",
                     groupvars=c("treatment","species"))
sumpmaxtopt

sumpmax = summarySE(testRlnc, na.rm=TRUE,measurevar="lnc",
                     groupvars=c("treatment","species"))
sumpmax


```
#- parameters E


E 
GP/R
~species*treatment
testGPEs
testREs
```{r}


#gross photo
# model
mPGPsp<-aov(E~species*treatment,testGP)
summary(mPGPsp) 

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 13- is 0 as is another not removing ,15 SA3,19 SF1
testGPE<-testGP[-c(15,19),]

mPGPsp<-aov(E~species*treatment, testGPE)
summary(mPGPsp)

  
# model
mPGPsp<-aov(E~species*treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=4, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4.05*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4.25*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 4 MC1 Use testR as outlier does not make sense as one SA3 is above that value for E
#testRE<-testR[-(4),]
mPGPsp<-aov(E~species*treatment, testR)
summary(mPGPsp)

ggline(testGPEs, "species", "E",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testREs, "species", "E",color= "treatment", add=c("mean_se", "dotplot"))


boxplot(E ~ species * treatment, data=testGPEs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="E")

boxplot(E ~ species * treatment, data=testREs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="E")

interaction.plot(x.factor = testGPEs$species, trace.factor = testGPEs$treatment, 
                 response = testGPEs$E, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="E")

interaction.plot(x.factor = testREs$species, trace.factor = testREs$treatment, 
                 response = testREs$E, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="E")


res.aov3 <- aov(E ~ species * treatment, data = testGPE)
#res.aov3r <- aov(E~ species * treatment, data = testRE)
res.aov3r2 <- aov(E~ species * treatment, data = testR)

summary(res.aov3) 
#summary(res.aov3r)
summary(res.aov3r2)

model.tables(res.aov3, type="means", se= TRUE)
model.tables(res.aov3r2, type="means", se= TRUE)

#TukeyHSD(res.aov3)
#TukeyHSD(res.aov3r)
#
#TukeyHSD(res.aov3, which = "species") 
#TukeyHSD(res.aov3r, which = "species")

summary(glht(res.aov3, linfct = mcp(species = "Tukey")))
summary(glht(res.aov3r, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPEs$E, testGPEs$species,
                p.adjust.method = "BH")
pairwise.t.test(testREs$E, testREs$species,
                p.adjust.method = "BH")

pairwise.t.test(testGPEs$E, testGPEs$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testREs$E, testREs$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aov3, 1) 
plot(res.aov3r, 1)
leveneTest(E ~ species* treatment, data = testGPEs)
leveneTest(E ~ species* treatment, data = testREs)
leveneTest(E ~ species* treatment, data = testGPE)
leveneTest(E ~ species* treatment, data = testRE)
leveneTest(E ~ species* treatment, data = testR)
#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality

plot(res.aov3, 2)
plot(res.aov3r, 2)

# Extract the residuals
aov_residuals3 <- residuals(object = res.aov3)
aov_residuals3r <- residuals(object = res.aov3r)
aov_residuals3r2 <- residuals(object = res.aov3r2)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals3 )
shapiro.test(x = aov_residuals3r )
shapiro.test(x = aov_residuals3r2 )
### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(E~species*treatment,testGPEs)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/EGPinPval.csv")

TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstableE <- rbind(maineffects, me_contrasts, interaction,  resid)
sstableE2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstableE$pes <- c(sstableE$'Sum Sq'[-nrow(sstableE)], NA)/(sstableE$'Sum Sq' + sstableE$'Sum Sq'[nrow(sstableE)]) # SS for each effect divided by the last SS (SS_residual)
View(sstableE)

options(knitr.kable.NA = '')

sstableE%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova E Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstableE) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstableE) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstableE) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstableE%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova E Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstableE2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova E Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (E)
res.aov3<-aov(E~species*treatment,testREs)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/ErinPval.csv")

TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstableE <- rbind(maineffects, me_contrasts, interaction,  resid)
sstableE2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstableE$pes <- c(sstableE$'Sum Sq'[-nrow(sstableE)], NA)/(sstableE$'Sum Sq' + sstableE$'Sum Sq'[nrow(sstableE)]) # SS for each effect divided by the last SS (SS_residual)
sstableE

options(knitr.kable.NA = '')

sstableE%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova E Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstableE) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstableE) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstableE%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova E Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstableE2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova E Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 
```


E by species
```{r}
# Topt by species

# GP species


# model
mPGPsp<-aov(E~species,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# - 15 SA3, 19 SF1
testGPEs<-testGP[-c(15,19),]
mPGPsp<-aov(E~species,testGPEs)
summary(mPGPsp)

# E comparisons between  species for respiration

# model
mPGPsp<-aov(E~species, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# remove 15 SA3
testREs<-testR[-(15),]
mPGPsp<-aov(E~species, testREs)
summary(mPGPsp)

#

ggline(testGPEs, "species", "E",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testREs, "species", "E",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(E ~ species, data=testGPEs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="E")

boxplot(E ~ species, data=testREs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="E")


res.aovagp <- aov(E ~ species, data = testGPEs)
res.aovar <- aov(E ~ species, data = testREs)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "species")
#TukeyHSD(res.aovar, which = "species")


#summary(glht(res.aovagp, linfct = mcp(species = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPEs$E, testGPEs$species,
                p.adjust.method = "BH")
pairwise.t.test(testREs$E, testREs$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(E ~ species, data = testGPEs)
leveneTest(E ~ species, data = testREs)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )
```


E by treatment
```{r}
# E by treatment

# GP treatment


# model
mPGPsp<-aov(E~treatment,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#15 SA3-19 SF1
#use testGPEs

mPGPsp<-aov(E~treatment,testGPEs)
summary(mPGPsp)


# E comparisons between  treatment for respiration

# model
mPGPsp<-aov(E~treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#use testRE
mPGPsp<-aov(E~treatment,testRE)
summary(mPGPsp)

#

ggline(testGPEs, "treatment", "E",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRE, "treatment", "E",color= "treatment", add=c("mean_se", "dotplot"))

# test individual species 

#DLABGP

mPGPsp<-aov(E~treatment, DtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#DLABR

mPGPsp<-aov(E~treatment, DtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#MCAV R

mPGPsp<-aov(E~treatment, MtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#MCAVGP

mPGPsp<-aov(E~treatment, MtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#OFRAR

mPGPsp<-aov(E~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#OFRAGP

mPGPsp<-aov(E~treatment, OtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#PASTR

mPGPsp<-aov(E~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#PASTGP

mPGPsp<-aov(E~treatment, PtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


boxplot(E ~ treatment, data=testGPEs, frame = FALSE, 
        col = c("green4", "green1"), ylab="E")

boxplot(E ~ treatment, data=testRE, frame = FALSE, 
        col = c("blue4", "blue1"), ylab="E")


res.aovagp <- aov(E ~ treatment, data = testGPEs)
res.aovar <- aov(E ~ treatment, data = testRE)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "treatment")
#TukeyHSD(res.aovar, which = "treatment")


#summary(glht(res.aovagp, linfct = mcp(treatment = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(treatment = "Tukey")))

pairwise.t.test(testGPEs$E, testGPEs$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testRE$E, testREs$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(E ~ treatment, data = testGPEs)
leveneTest(E ~ treatment, data = testRE)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )
## Not normal
# log E for respiration & Gross Photo

### log parameter E R- failed shapiro 
testRE$log.E <- log(testRE$E+ 1) 

mPGPsp<-aov(log.E~treatment,testRE)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.E~treatment, testRE) 

res.aovar <- aov(log.E ~ treatment, data = testRE)

### log parameter E GP- failed shapiro
testGPEs$log.E <- log(testGPEs$E+ 1) 

mPGPsp<-aov(log.E~treatment,testGPEs)
summary(mPGPsp)
 # not significant 
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.E~treatment, testGPEs) 

res.aovar <- aov(log.E ~ treatment, data = testGPEs)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )

########
log.ERD <-aov(log.E~treatment,DtestR)
log.ERM <-aov(log.E~treatment,MtestR)
log.ERO <-aov(log.E~treatment,OtestR)
log.ERP <-aov(log.E~treatment,PtestR)
log.EPD <-aov(log.E~treatment,DtestGP)
log.EPM <-aov(log.E~treatment,MtestGP)
log.EPO <-aov(log.E~treatment,OtestGP)
log.EPP <-aov(log.E~treatment,PtestGP)
EPD <-aov(E~treatment,DtestGP)
EPM <-aov(E~treatment,MtestGP)
EPO <-aov(E~treatment,OtestGP)
EPP <-aov(E~treatment,PtestGP)
### test each species
summary(log.ERD) 
summary(log.ERM) 
summary(log.ERO) 
summary(log.ERP)# 
summary(EPD) 
summary(EPM) 
summary(EPO) 
summary(EPP) 
summary(log.EPD)
summary(log.EPM)
summary(log.EPO)
summary(log.EPP)


#########
##testGPE
##testRE
sumEGP = summarySE(testGPE,
                measurevar="E",            groupvars=c("treatment","species"))

sumER = summarySE(testRE,
                measurevar="log.E",            groupvars=c("treatment","species"))

sumEGP
sumER

#####
data_summary <- function(data, varname, groupnames){
  require(plyr)
  summary_func <- function(x, col){
    c(mean = mean(x[[col]], na.rm=TRUE),
      sd = sd(x[[col]], na.rm=TRUE))
  }
  data_sum<-ddply(data, groupnames, .fun=summary_func,
                  varname)
  data_sum <- rename(data_sum, c("mean" = varname))
  return(data_sum)
}

testRE2<-testRE
df2 <- data_summary(testRE2, varname="log.E", 
                    groupnames=c("fragment.ID2", "treatment"))

# Convert dose to a factor variable
head(df2)

p<- ggplot(df2, aes(x=fragment.ID2, y=log.E, group=treatment, color=treatment)) + 
  geom_smooth(method='lm', formula= y~x, alpha= 0.15) +
  geom_point(size=2,position=position_dodge(0.5))+
  geom_errorbar(aes(ymin=log.E-sd, ymax=log.E+sd), width=.2,
                position=position_dodge(0.5))+
  labs(y="log.E", x = "Energy(eV)")+
  theme_classic() +
  scale_color_manual(values=c('maroon','magenta'))
p

DtestGP2<-DtestGP
df2 <- data_summary(DtestGP2, varname="Eh", 
                    groupnames=c("fragment.ID2", "treatment"))

mPGPsp<-aov(Eh~treatment, DtestGP)

#fragment.ID2 treatment       Eh        sd
#1           ML      deep 5.122169 0.9266363
#2           SL   shallow 3.188172 0.6809566

```

Eh 
GP/R
~species*treatment

```{r}


#gross photo
# model
mPGPsp<-aov(Eh~species*treatment,testGP)
summary(mPGPsp) 
## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 5MC2
testGPEh<-testGP[-(5),]

mPGPsp<-aov(Eh~species*treatment, testGPEh)
summary(mPGPsp)

# model
mPGPsp<-aov(Eh~species*treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 5MC2
testREh<-testR[-(5),]

# model
mPGPsp<-aov(Eh~species*treatment, testREh)
summary(mPGPsp)

ggline(testGPEhs, "species", "Eh",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testREht, "species", "Eh",color= "treatment", add=c("mean_se", "dotplot"))


boxplot(Eh ~ species * treatment, data=testGPEhs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="Eh")

boxplot(Eh ~ species * treatment, data=testREht, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="Eh")

interaction.plot(x.factor = testGPEhs$species, trace.factor = testGPEhs$treatment, 
                 response = testGPEhs$Eh, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="Eh")

interaction.plot(x.factor = testREht$species, trace.factor = testREht$treatment, 
                 response = testREht$Eh, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="Eh")


res.aov3 <- aov(Eh ~ species * treatment, data = testGPEh)
res.aov3r <- aov(Eh~ species * treatment, data = testREh)


summary(res.aov3) 
summary(res.aov3r)

model.tables(res.aov3, type="means", se= TRUE)
model.tables(res.aov3r, type="means", se= TRUE)

TukeyHSD(res.aov3)
#TukeyHSD(res.aov3r)
#
#TukeyHSD(res.aov3, which = "species") 
#TukeyHSD(res.aov3r, which = "species")

summary(glht(res.aov3, linfct = mcp(species = "Tukey")))
summary(glht(res.aov3r, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPEh$Eh, testGPEh$species,
                p.adjust.method = "BH")
pairwise.t.test(testREh$Eh, testREh$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aov3, 1) 
plot(res.aov3r, 1)
leveneTest(Eh ~ species* treatment, data = testGPEh)
leveneTest(Eh ~ species* treatment, data = testREh)
#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality

plot(res.aov3, 2)
plot(res.aov3r, 2)

# Extract the residuals
aov_residuals3 <- residuals(object = res.aov3)
aov_residuals3r <- residuals(object = res.aov3r)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals3 )
shapiro.test(x = aov_residuals3r )

### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(Eh~species*treatment,testGPEhs)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/EhGPinPval.csv")

#TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstableEh <- rbind(maineffects, me_contrasts, interaction,  resid)
sstableEh2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstableEh$pes <- c(sstableEh$'Sum Sq'[-nrow(sstableEh)], NA)/(sstableEh$'Sum Sq' + sstableEh$'Sum Sq'[nrow(sstableEh)]) # SS for each effect divided by the last SS (SS_residual)
#View(sstableEh)

options(knitr.kable.NA = '')

sstableEh%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Eh Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstableEh) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstableEh) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstableEh) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstableEh%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Eh Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstableEh2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Eh Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (Eh)
res.aov3<-aov(Eh~species*treatment,testREht)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/EhrinPval.csv")

#TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstableEh <- rbind(maineffects, me_contrasts, interaction,  resid)
sstableEh2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstableEh$pes <- c(sstableEh$'Sum Sq'[-nrow(sstableEh)], NA)/(sstableEh$'Sum Sq' + sstableEh$'Sum Sq'[nrow(sstableEh)]) # SS for each effect divided by the last SS (SS_residual)
sstableEh

options(knitr.kable.NA = '')

sstableEh%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Eh Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstableEh) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstableEh) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstableEh%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Eh Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstableEh2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Eh Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 
```




Eh by species
```{r}
# Eh by species

# GP species


# model
mPGPsp<-aov(Eh~species,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#5 MC2

testGPEhs<-testGP[-(5),]
#use testGPEhs
mPGPsp<-aov(Eh~species,testGPEhs)
summary(mPGPsp)

# Eh comparisons between  species for respiration

# model
mPGPsp<-aov(Eh~species, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
# 5 MC2, 8 MF2
testREhs<-testR[-c(5,8),]

mPGPsp<-aov(Eh~species, testREhs)
summary(mPGPsp)

#

ggline(testGPEhs, "species", "Eh",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testREhs, "species", "Eh",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(Eh ~ species, data=testGPEhs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="Eh")

boxplot(Eh ~ species, data=testREhs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="Eh")


res.aovagp <- aov(Eh ~ species, data = testGPEhs)
res.aovar <- aov(Eh ~ species, data = testREhs)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "species")
#TukeyHSD(res.aovar, which = "species")


#summary(glht(res.aovagp, linfct = mcp(species = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPEhs$Eh, testGPEhs$species,
                p.adjust.method = "BH")
pairwise.t.test(testREhs$Eh, testREhs$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(Eh ~ species, data = testGPEhs)
leveneTest(Eh ~ species, data = testREhs)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )
```
Eh by treatment
```{r}
# Eh by treatment

# GP treatment


# model
mPGPsp<-aov(Eh~treatment,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
# 5 MC2 # use testGPEhs
mPGPsp<-aov(Eh~treatment,testGPEhs)
summary(mPGPsp)


# Eh comparisons between  treatment for respiration

# model
mPGPsp<-aov(Eh~treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#outliers 5 MC2
testREht<-testR[-(5),]

mPGPsp<-aov(Eh~treatment,testREht)
summary(mPGPsp)
#
 
#DLABGP

mPGPsp<-aov(Eh~treatment, DtestGP)
summary(mPGPsp) #0.0435

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#DLABR

mPGPsp<-aov(Eh~treatment, DtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#MCAV R

mPGPsp<-aov(Eh~treatment, MtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#MCAVGP

mPGPsp<-aov(Eh~treatment, MtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#OFRAR

mPGPsp<-aov(Eh~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#OFRAGP

mPGPsp<-aov(Eh~treatment, OtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#PASTR

mPGPsp<-aov(Eh~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#PASTGP

mPGPsp<-aov(Eh~treatment, PtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

ggline(testGPEhs, "treatment", "Eh",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testREht, "treatment", "Eh",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(Eh ~ treatment, data=testGPEhs, frame = FALSE, 
        col = c("green4", "green1"), ylab="Eh")

boxplot(Eh ~ treatment, data=testREht, frame = FALSE, 
        col = c("blue4", "blue1"), ylab="Eh")


res.aovagp <- aov(Eh ~ treatment, data = testGPEhs)
res.aovar <- aov(Eh ~ treatment, data = testREht)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "treatment")
#TukeyHSD(res.aovar, which = "treatment")


#summary(glht(res.aovagp, linfct = mcp(treatment = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(treatment = "Tukey")))

pairwise.t.test(testGPEhs$Eh, testGPEhs$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testREht$Eh, testREht$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(Eh ~ treatment, data = testGPEhs)
leveneTest(Eh ~ treatment, data = testREht)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
## Not normal
# log Eh for respiration & gross photo (Log)

# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )


### log parameter E GP- failed shapiro
testGPEhs$log.Eh <- log(testGPEhs$Eh+ 1) 

mPGPsp<-aov(log.Eh~treatment,testGPEhs)
summary(mPGPsp)
# not significant 
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.Eh~treatment, testGPEhs) 


### log parameter E R- failed shapiro
testREht$log.Eh <- log(testREht$Eh+ 1) 

mPGPsp<-aov(log.Eh~treatment,testREht)
summary(mPGPsp)
# not significant 
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.Eh~treatment, testREht) 
```

Th


Th_C 
GP/R
~species*treatment

```{r}


#gross photo
# model
mPGPsp<-aov(Th_C~species*treatment,testGP)
summary(mPGPsp) 
## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove 13 SA1 15 SA3 reject cooks
testGPTh_C<-testGP[-(15),]
##
#mPGPsp<-aov(Th_C~species*treatment, testGPTh_Ct)
#summary(mPGPsp)

mPGPsp<-aov(Th_C~species*treatment,testGPTh_C)
summary(mPGPsp)
# model
mPGPsp<-aov(Th_C~species*treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.8, pos=1, col="red")

#remove 3 MA3  
testRTh_C<-testR[-(3),]


# model
mPGPsp<-aov(Th_C~species*treatment, testRTh_C)
summary(mPGPsp)


ggline(testGPTh_Ct, "species", "Th_C",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRTh_Cs, "species", "Th_C",color= "treatment", add=c("mean_se", "dotplot"))


boxplot(Th_C ~ species * treatment, data=testGPTh_Ct, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="Th_C")

boxplot(Th_C ~ species * treatment, data=testRTh_Cs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="Th_C")

interaction.plot(x.factor = testGPTh_Ct$species, trace.factor = testGPTh_Ct$treatment, 
                 response = testGPTh_Ct$Th_C, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="Th_C")

interaction.plot(x.factor = testRTh_Cs$species, trace.factor = testRTh_Cs$treatment, 
                 response = testRTh_Cs$Th_C, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="Th_C")


res.aov3 <- aov(Th_C ~ species * treatment, data = testGP)
res.aov3r <- aov(Th_C~ species * treatment, data = testRTh_C)


summary(res.aov3) 
summary(res.aov3r)

model.tables(res.aov3, type="means", se= TRUE)
model.tables(res.aov3r, type="means", se= TRUE)

TukeyHSD(res.aov3)
TukeyHSD(res.aov3r)
#
#TukeyHSD(res.aov3, which = "species") 
#TukeyHSD(res.aov3r, which = "species")

summary(glht(res.aov3, linfct = mcp(species = "Tukey")))
summary(glht(res.aov3r, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPTh_Ct$Th_C, testGPTh_Ct$species,
                p.adjust.method = "BH")
pairwise.t.test(testRTh_Cs$Th_C, testRTh_Cs$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aov3, 1) 
plot(res.aov3r, 1)
leveneTest(Th_C ~ species* treatment, data = testGP)
leveneTest(Th_C ~ species* treatment, data = testRTh_C)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality

plot(res.aov3, 2)
plot(res.aov3r, 2)
## Looks good
# Extract the residuals
aov_residuals3 <- residuals(object = res.aov3)
aov_residuals3r <- residuals(object = res.aov3r)
aov_residuals3rt <- residuals(object = res.aov3rt)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals3 )
shapiro.test(x = aov_residuals3r )
#shapiro.test(x = aov_residuals3rt )

### log parameter Th_C GP- failed shapiro
#testGPTh_C$log.Th_C <- log(testGPTh_C$Th_C+ 1) 
#
#mPGPsp<-aov(log.Th_C~species*treatment,testGPTh_C)
#summary(mPGPsp)

## Extract the residuals
#aov_residuals <- residuals(object = mPGPsp )
## Run Shapiro-Wilk test
#shapiro.test(x = aov_residuals )
#leveneTest(log.Th_C~treatment, testGPTh_C) 
####

### log parameter E R- failed shapiro
testRTh_C$log.Th_C <- log(testRTh_C$Th_C+ 1) 

mPGPsp<-aov(log.Th_C~species*treatment,testRTh_C)
summary(mPGPsp)
# not significant 
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.Th_C~treatment, testRTh_C) 


### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(log.Th_C~species*treatment,testRTh_C)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/Th_CGPinPval.csv")

TukeyHSD(res.aov3)

summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]
contrasts

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstableTh_C <- rbind(maineffects, me_contrasts, interaction,  resid)
sstableTh_C2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstableTh_C$pes <- c(sstableTh_C$'Sum Sq'[-nrow(sstableTh_C)], NA)/(sstableTh_C$'Sum Sq' + sstableTh_C$'Sum Sq'[nrow(sstableTh_C)]) # SS for each effect divided by the last SS (SS_residual)
#View(sstableTh_C)

options(knitr.kable.NA = '')

sstableTh_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Th_C Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstableTh_C) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstableTh_C) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstableTh_C) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstableTh_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Th_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstableTh_C2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Th_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (Th_C)
res.aov3<-aov(Th_C~species*treatment,testRTh_Cs)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/Th_CrinPval.csv")

#TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstableTh_C <- rbind(maineffects, me_contrasts, interaction,  resid)
sstableTh_C2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstableTh_C$pes <- c(sstableTh_C$'Sum Sq'[-nrow(sstableTh_C)], NA)/(sstableTh_C$'Sum Sq' + sstableTh_C$'Sum Sq'[nrow(sstableTh_C)]) # SS for each effect divided by the last SS (SS_residual)
sstableTh_C

options(knitr.kable.NA = '')

sstableTh_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Th_C Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstableTh_C) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstableTh_C) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstableTh_C%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Th_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstableTh_C2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova Th_C Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 
```


Th_C by species
```{r}
# Topt by species

# GP species


# model
mPGPsp<-aov(Th_C~species,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 15 SA3 22 SL1
testGPTh_Cs<-testGP[-c(15,22),]
#use testGPTh_Ct
mPGPsp<-aov(Th_C~species,testGPTh_Cs)
summary(mPGPsp)

# Th_C comparisons between  species for respiration

# model
mPGPsp<-aov(Th_C~species, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 3 MA3
testRTh_Cs<-testR[-(3),]

mPGPsp<-aov(Th_C~species, testRTh_Cs)
summary(mPGPsp)

#

ggline(testGPTh_Ct, "species", "Th_C",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRTh_Cs, "species", "Th_C",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(Th_C ~ species, data=testGPTh_Ct, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="Th_C")

boxplot(Th_C ~ species, data=testRTh_Cs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="Th_C")


res.aovagp <- aov(Th_C ~ species, data = testGPTh_Ct)
res.aovar <- aov(Th_C ~ species, data = testRTh_Cs)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "species")
#TukeyHSD(res.aovar, which = "species")


#summary(glht(res.aovagp, linfct = mcp(species = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPTh_Ct$Th_C, testGPTh_Ct$species,
                p.adjust.method = "BH")
pairwise.t.test(testRTh_Cs$Th_C, testRTh_Cs$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(Th_C ~ species, data = testGPTh_Ct)
leveneTest(Th_C ~ species, data = testRTh_Cs)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )

### log parameter E GP- failed shapiro
testGPTh_Ct$log.Th_C <- log(testGPTh_Ct$Th_C+ 1) 

mPGPsp<-aov(log.Th_C~species,testGPTh_Ct)
summary(mPGPsp)
TukeyHSD(mPGPsp)
plot(mPGPsp, 2)
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.Th_C~species, testGPTh_Ct) 


### log parameter E R- failed shapiro
testRTh_Cs$log.Th_C <- log(testRTh_Cs$Th_C+ 1) 

mPGPsp<-aov(log.Th_C~species,testRTh_C)
summary(mPGPsp)
# not significant 
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.Th_C~species, testRTh_Cs) 

```


Th_C by treatment
```{r}
# Th_C by treatment

# GP treatment


# model
mPGPsp<-aov(Th_C~treatment,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#
#outliers 15 SA3
testGPTh_Ct<-testGP[-(15),]

mPGPsp<-aov(Th_C~treatment,testGPTh_Ct)
summary(mPGPsp)


# Th_C comparisons between  treatment for respiration

# model
mPGPsp<-aov(Th_C~treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#outliers 3 MA3
# use testRTh_Cs

mPGPsp<-aov(Th_C~treatment,testRTh_Cs)
summary(mPGPsp)
#
# test individual species against depth
#DLABGP

mPGPsp<-aov(Th_C~treatment, DtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#DLABR

mPGPsp<-aov(Th_C~treatment, DtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#MCAV R

mPGPsp<-aov(Th_C~treatment, MtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#MCAVGP

mPGPsp<-aov(Th_C~treatment, MtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#OFRAR

mPGPsp<-aov(Th_C~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#OFRAGP

mPGPsp<-aov(Th_C~treatment, OtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#PASTR

mPGPsp<-aov(Th_C~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#PASTGP

mPGPsp<-aov(Th_C~treatment, PtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

ggline(testGPTh_Ct, "treatment", "Th_C",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRTh_Cs, "treatment", "Th_C",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(Th_C ~ treatment, data=testGPTh_Ct, frame = FALSE, 
        col = c("green4", "green1"), ylab="Th_C")

boxplot(Th_C ~ treatment, data=testRTh_Cs, frame = FALSE, 
        col = c("blue4", "blue1"), ylab="Th_C")


res.aovagp <- aov(Th_C ~ treatment, data = testGPTh_Ct)
res.aovar <- aov(Th_C ~ treatment, data = testRTh_Cs)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "treatment")
#TukeyHSD(res.aovar, which = "treatment")


#summary(glht(res.aovagp, linfct = mcp(treatment = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(treatment = "Tukey")))

pairwise.t.test(testGPTh_Ct$Th_C, testGPTh_Ct$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testRTh_Cs$Th_C, testRTh_Cs$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(Th_C ~ treatment, data = testGPTh_Ct)
leveneTest(Th_C ~ treatment, data = testRTh_Cs)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
## Not normal
# log Th_C for respiration & gross photo (Log)

# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )



```

 lnc
 

lnc 
GP/R
~species*treatment

```{r}


#gross photo
# model
mPGPsp<-aov(lnc~species*treatment,testGP)
summary(mPGPsp) 
## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#remove  15 SA3
testGPlnc<-testGP[-(15),]

mPGPsp<-aov(lnc~species*treatment, testGPlnc)
summary(mPGPsp)
anova
# model
mPGPsp<-aov(lnc~species*treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#No outliers
testRlncs<-testR

# model
mPGPsp<-aov(lnc~species*treatment, testRlncs)
summary(mPGPsp)

ggline(testGPlnct, "species", "lnc",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRlncs, "species", "lnc",color= "treatment", add=c("mean_se", "dotplot"))


boxplot(lnc ~ species * treatment, data=testGPlnct, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="lnc")

boxplot(lnc ~ species * treatment, data=testRlncs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue", "orange", "green", "purple", "blue"), ylab="lnc")

interaction.plot(x.factor = testGPlnct$species, trace.factor = testGPlnct$treatment, 
                 response = testGPlnct$lnc, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="lnc")

interaction.plot(x.factor = testRlncs$species, trace.factor = testRlncs$treatment, 
                 response = testRlncs$lnc, fun = mean, 
                 type = "b", legend = TRUE, 
                 xlab = "Species", ylab="lnc")


res.aov3 <- aov(lnc ~ species * treatment, data = testGPlnc)
res.aov3r <- aov(lnc~ species * treatment, data = testRlnc)


summary(res.aov3) 
summary(res.aov3r)

model.tables(res.aov3, type="means", se= TRUE)
model.tables(res.aov3r, type="means", se= TRUE)

#TukeyHSD(res.aov3)
#TukeyHSD(res.aov3r)
#
#TukeyHSD(res.aov3, which = "species") 
#TukeyHSD(res.aov3r, which = "species")

summary(glht(res.aov3, linfct = mcp(species = "Tukey")))
summary(glht(res.aov3r, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPlnct$lnc, testGPlnct$species,
                p.adjust.method = "BH")
pairwise.t.test(testRlncs$lnc, testRlncs$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aov3, 1) 
plot(res.aov3r, 1)
leveneTest(lnc ~ species* treatment, data = testGPlnc)
leveneTest(lnc ~ species* treatment, data = testRlnc)
#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality

plot(res.aov3, 2)
plot(res.aov3r, 2)
## Looks good
# Extract the residuals
aov_residuals3 <- residuals(object = res.aov3)
aov_residuals3r <- residuals(object = res.aov3r)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals3 )
shapiro.test(x = aov_residuals3r )

### make tables of pvalues for interaction GRoss photo

res.aov3<-aov(lnc~species*treatment,testGPlnct)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/lncGPinPval.csv")

#TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstablelnc <- rbind(maineffects, me_contrasts, interaction,  resid)
sstablelnc2 <- rbind(maineffects, me_contrasts, interaction,  resid)

sstablelnc$pes <- c(sstablelnc$'Sum Sq'[-nrow(sstablelnc)], NA)/(sstablelnc$'Sum Sq' + sstablelnc$'Sum Sq'[nrow(sstablelnc)]) # SS for each effect divided by the last SS (SS_residual)
#View(sstablelnc)

options(knitr.kable.NA = '')

sstablelnc%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova lnc Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstablelnc) <- c("SS", "df", "italic(F)", "italic(p)", "partial $\\eta^2$")

colnames(sstablelnc) <- c( "SS", "df", "$\\F$", "$\\alpha$p","expression(paste(*eta^2))")


rownames(sstablelnc) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstablelnc%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova lnc Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstablelnc2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova lnc Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

### TABLES for Pvalus for respiration (lnc)
res.aov3<-aov(lnc~species*treatment,testRlncs)
sstable<-Anova(res.aov3, type=2)
sstable
#write.csv(sstable, "C:/Github/TPC_BDA_github/lncrinPval.csv")

#TukeyHSD(res.aov3)
summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))

contrasts <- summary.aov(res.aov3, split = list(species=list(DLAB=0, MCAV=1, OFRA=2, PAST=3)))[[1]][c(1,2,3, 4,5, 7), c(2, 1, 4, 5)]

# select the rows to combine
maineffects <- sstable[c(1,2), ]
me_contrasts <- contrasts[c(2,3,4,5), ]
interaction <- sstable[3, ]
resid <- sstable[4, ]

# bind the rows together in the desired order
sstablelnc <- rbind(maineffects, me_contrasts, interaction,  resid)
sstablelnc2 <- rbind(maineffects, me_contrasts, interaction,  resid)


sstablelnc$pes <- c(sstablelnc$'Sum Sq'[-nrow(sstablelnc)], NA)/(sstablelnc$'Sum Sq' + sstablelnc$'Sum Sq'[nrow(sstablelnc)]) # SS for each effect divided by the last SS (SS_residual)
sstablelnc

options(knitr.kable.NA = '')

sstablelnc%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova lnc Gross Photosynthesis ") %>% 
  # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


colnames(sstablelnc) <- c("SS", "df", "F", "p.value", "(eta^2)")

rownames(sstablelnc) <- c("Species", "Depth", "D. labyrinthyformis", "M. cavernosa", "O. franksi", "P. astreoides", "Species:Depth", "Residuals")

kable(sstable, digits = 3, format = "pandoc", caption = "ANOVA table")

sstablelnc%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova lnc Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value","eta-squared")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 

sstablelnc2%>% 
  # Add a title
  kableExtra::kable( digits = 3,caption=" Anova lnc Gross Photosynthesis ", col.names = c ("SS", "df", "F", "p-value")) %>% 
  kable_styling(bootstrap_options = "condensed", full_width=F) 
```


lnc by species
```{r}
# Topt by species

# GP species


# model
mPGPsp<-aov(lnc~species,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 15 SA3
testGPlnc

#use testGPlnct
mPGPsp<-aov(lnc~species,testGPlnc)
summary(mPGPsp)

# lnc comparisons between  species for respiration

# model
mPGPsp<-aov(lnc~species, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 15 SA3
testRlncs<-testR[-(15),]

mPGPsp<-aov(lnc~species, testRlncs)
summary(mPGPsp)

#

ggline(testGPlnct, "species", "lnc",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRlncs, "species", "lnc",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(lnc ~ species, data=testGPlnct, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="lnc")

boxplot(lnc ~ species, data=testRlncs, frame = FALSE, 
        col = c("orange", "green", "purple", "blue"), ylab="lnc")


res.aovagp <- aov(lnc ~ species, data = testGPlnct)
res.aovar <- aov(lnc ~ species, data = testRlncs)

summary(res.aovagp)
summary(res.aovar)

model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


TukeyHSD(res.aovagp, which = "species")
#TukeyHSD(res.aovar, which = "species")


#summary(glht(res.aovagp, linfct = mcp(species = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(species = "Tukey")))

pairwise.t.test(testGPlnct$lnc, testGPlnct$species,
                p.adjust.method = "BH")
pairwise.t.test(testRlncs$lnc, testRlncs$species,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(lnc ~ species, data = testGPlnct)
leveneTest(lnc ~ species, data = testRlncs)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
# Extract the residuals
#Non-normal log transform
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )

### log parameter E GP- failed shapiro
testGPlnct$log.lnc <- log(testGPlnct$lnc+ 1) 

mPGPsp<-aov(log.lnc~species,testGPlnct)
summary(mPGPsp)
TukeyHSD(mPGPsp)
plot(mPGPsp, 2)
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.lnc~species, testGPlnct) 

```
lnc by treatment
```{r}
# lnc by treatment

# GP treatment


# model
mPGPsp<-aov(lnc~treatment,testGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#
#outliers 15 SA3
testGPlnct<-testGP[-(15),]

mPGPsp<-aov(lnc~treatment,testGPlnct)
summary(mPGPsp)


# lnc comparisons between  treatment for respiration

# model
mPGPsp<-aov(lnc~treatment, testR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#outliers 4 MC1

testRlncs<-testR[-(4),]

mPGPsp<-aov(lnc~treatment,testRlncs)
summary(mPGPsp)
#
#DLABGP

mPGPsp<-aov(lnc~treatment, subset(testGPlnct, species=="DLAB"))
summary(mPGPsp)

DtestGPlnct<-subset(testGPlnct, species=="DLAB")
DDtestGPlnct<-subset(DtestGPlnct, treatment=="deep")
SDtestGPlnct<-subset(DtestGPlnct, treatment=="shallow")

mean(DDtestGPlnct$lnc)
mean(SDtestGPlnct$lnc)


mPGPsp<-aov(Pmax~treatment, DtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#DLABR

mPGPsp<-aov(lnc~treatment, DtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")


#MCAV R

mPGPsp<-aov(lnc~treatment, MtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#MCAVGP

mPGPsp<-aov(lnc~treatment, MtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#OFRAR

mPGPsp<-aov(lnc~treatment, OtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#OFRAGP

mPGPsp<-aov(lnc~treatment, OtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#PASTR

mPGPsp<-aov(lnc~treatment, PtestR)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#PASTGP

mPGPsp<-aov(lnc~treatment, PtestGP)
summary(mPGPsp)

## check for outliers
cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

ggline(testGPlnct, "treatment", "lnc",color= "treatment", add=c("mean_se", "dotplot"))
ggline(testRlncs, "treatment", "lnc",color= "treatment", add=c("mean_se", "dotplot"))



boxplot(lnc ~ treatment, data=testGPlnct, frame = FALSE, 
        col = c("green4", "green1"), ylab="lnc")

boxplot(lnc ~ treatment, data=testRlncs, frame = FALSE, 
        col = c("blue4", "blue1"), ylab="lnc")


res.aovagp <- aov(lnc ~ treatment, data = testGPlnct)
res.aovar <- aov(lnc ~ treatment, data = testRlncs)

summary(res.aovagp)
summary(res.aovar)


model.tables(res.aovagp, type="means", se= TRUE)
model.tables(res.aovar, type="means", se= TRUE)


#TukeyHSD(res.aovagp, which = "treatment")
#TukeyHSD(res.aovar, which = "treatment")


#summary(glht(res.aovagp, linfct = mcp(treatment = "Tukey")))
#summary(glht(res.aovar, linfct = mcp(treatment = "Tukey")))

pairwise.t.test(testGPlnct$lnc, testGPlnct$treatment,
                p.adjust.method = "BH")
pairwise.t.test(testRlncs$lnc, testRlncs$treatment,
                p.adjust.method = "BH")
##ANOVA assumes that the data are normally distributed and the variance across groups are homogeneous. We can check that with some diagnostic plots.

# 1. Homogeneity of variances
plot(res.aovagp, 1)
plot(res.aovar, 1)

leveneTest(lnc ~ treatment, data = testGPlnct)
leveneTest(lnc ~ treatment, data = testRlncs)

#no evidence to suggest that the variance across groups is statistically significantly different. Therefore, we can assume the homogeneity of variances in the different treatment groups.

# 2. Normality
plot(res.aovagp, 2)
plot(res.aovar, 2)
## Not normal
# log lnc for respiration & gross photo (Log)

# Extract the residuals
aov_residualsagp <- residuals(object = res.aovagp)
aov_residualsar <- residuals(object = res.aovar)
# Run Shapiro-Wilk test

shapiro.test(x = aov_residualsagp )
shapiro.test(x = aov_residualsar )


### log parameter E R- failed shapiro
testRlncs$log.lnc <- log(testRlncs$lnc+ 1) 

mPGPsp<-aov(log.lnc~treatment,testRlncs)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(log.lnc~treatment, testRlncs2) 
```








```{r}
mPGPsp<-aov(Pmax~treatment,GPpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
#### p-value sig
kruskal.test(Pmax~treatment,GPpmax)

mPGPsp<-aov(Pmax~species,GPpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(Pmax~species, GPpmax)


mPGPsp<-aov(Pmax~species*treatment,GPpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals)



# PErforma all tests on oulier data
#R

mPGPsp<-aov(Pmax~treatment,Rpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
#### p-value sig
kruskal.test(Pmax~treatment,Rpmax)

mPGPsp<-aov(Pmax~species,Rpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(Pmax~species, Rpmax)

mPGPsp<-aov(Pmax~species*treatment,Rpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


plotNormalHistogram(Rpmax$Pmax)
qqnorm(Rpmax$Pmax,
       ylab="Sample #Quantiles for Pmax")
qqline(Rpmax$Pmax,col="red")


#levene's test
##GP
leveneTest(Pmax~treatment, data=GPpmax) 
leveneTest(Pmax~species, data=GPpmax) 
leveneTest(Pmax~species*treatment, data=GPpmax) 
#R
leveneTest(Pmax~treatment, data=Rpmax) 
leveneTest(Pmax~species, data=Rpmax)  
leveneTest(Pmax~species*treatment, data=Rpmax)

### 

library(FSA)
#GP
Summarize(Pmax~species*treatment,GPpmax)
PP<-Summarize(Pmax~species,GPpmax)
PT<-Summarize(Pmax~treatment,GPpmax)

PP%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
PT%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
#R
Summarize(Pmax~species*treatment,testGP)
PRs<-Summarize(Pmax~species,Rpmax)
PRt<-Summarize(Pmax~treatment,Rpmax)

PRs%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


PT%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


library(lattice)
#GP
histogram(~ Pmax | treatment, GPpmax) 
kruskal.test(Pmax~treatment, GPpmax) 
histogram(~ Pmax | species, GPpmax) 
kruskal.test(Pmax~species, GPpmax)  
histogram(~ Pmax | species*treatment, GPpmax) 
#R
histogram(~ Pmax | treatment, Rpmax) 
kruskal.test(Pmax~treatment, Rpmax)
histogram(~ Pmax | species, Rpmax) 
kruskal.test(Pmax~species, Rpmax) 
histogram(~ Pmax | species*treatment, Rpmax) 


### Pmax Species

# Create a model to plot
P.mod <- lm(Pmax~species,GPpmax)
summary(P.mod)


#lm(formula = Pmax ~ species, data = GPpmax)
#
#Residuals:
#      Min        1Q    Median        3Q       Max 
#-0.077645 -0.025015 -0.000096  0.030386  0.066823 
#
#Coefficients:
#            Estimate Std. Error t value Pr(>|t|)    
#(Intercept)  1.24208    0.01985  62.566  < 2e-16 ***
#speciesMCAV -0.35395    0.02808 -12.607 2.20e-09 ***
#speciesOFRA -0.06567    0.02688  -2.443   0.0274 *  
#speciesPAST -0.26635    0.03242  -8.216 6.19e-07 ***

summ(P.mod, confint = TRUE, digits = 3)
effect_plot(P.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(P.mod)
plot_summs(P.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(P.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)



export_summs(P.mod, scale = TRUE)

coefPS <- as.data.frame(summary(P.mod)$coefficients[-1,1:2])
names(coefPS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefPS$vars = coral

PS<-ggplot(coefPS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("log")+
  xlab("")+
  ggtitle('Pmax')
 
PS

# kruskal plot
histogram(~ Pmax | species,GPpmax)     #  columns and rows of individual plots
          
## Species with Kruskal test
 Pmax.modk<- kruskal.test(Pmax~species,GPpmax) 
boxplot(Pmax~species,GPpmax)
#Post hoc Dunn test- describes Which variables have sign diifference 
#Dunn (1964) Kruskal-Wallis multiple comparison
 # p-values adjusted with the Holm method.
DT<-dunnTest(Pmax~species,GPpmax,method="holm")
DT


#DT<-dunnTest(Pmax~species,testGP,method="bonferroni")
#DT
PT = DT$res
PT
cldList(P.adj ~ Comparison,
        data = PT,
        threshold = 0.05)

#Group Letter MonoLetter
#1  DLAB      a        a  
#2  MCAV      b         b 
#3  OFRA     a          a 
#4  PAST     ab         ab
#Groups sharing a letter not signficantly different (alpha = 0.05).

Sum = groupwiseMedian(Pmax~species,GPpmax,conf= 0.95,R= 5000,percentile = TRUE,bca= FALSE,digits = 4)
Sum

X= 1:4
Y = Sum$Percentile.upper + 0.2
Label = c("a", "b", "ac", "bc")
```


```{r}
mPGPsp<-aov(Pmax~species,R_Pmaxsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# Respiration Pmax_ outlier = #7 MF	OFRA	MF1	R

R_Pmaxsp<-R_Pmaxsp[-19,]

Rpmax<-R2


### test all species- treatment- species *treatment, and remove ouliers from sigificant tests- Only species significant for Pmax GP as well
mPGPsp<-aov(Pmax~species,testGP)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 3*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>3*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#GP outlier= 1,2, 6 remove from testGP
GPpmax<-testGP[-c(1,2,6),]

mPGPsp<-aov(Pmax~treatment,GPpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
#### p-value sig
kruskal.test(Pmax~treatment,GPpmax)

mPGPsp<-aov(Pmax~species,GPpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(Pmax~species, GPpmax)


mPGPsp<-aov(Pmax~species*treatment,GPpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals)



# PErforma all tests on oulier data
#R

mPGPsp<-aov(Pmax~treatment,Rpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
#### p-value sig
kruskal.test(Pmax~treatment,Rpmax)

mPGPsp<-aov(Pmax~species,Rpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(Pmax~species, Rpmax)

mPGPsp<-aov(Pmax~species*treatment,Rpmax)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


plotNormalHistogram(Rpmax$Pmax)
qqnorm(Rpmax$Pmax,
       ylab="Sample #Quantiles for Pmax")
qqline(Rpmax$Pmax,col="red")


#levene's test
##GP
leveneTest(Pmax~treatment, data=GPpmax) 
leveneTest(Pmax~species, data=GPpmax) 
leveneTest(Pmax~species*treatment, data=GPpmax) 
#R
leveneTest(Pmax~treatment, data=Rpmax) 
leveneTest(Pmax~species, data=Rpmax)  
leveneTest(Pmax~species*treatment, data=Rpmax)

### 

library(FSA)
#GP
Summarize(Pmax~species*treatment,GPpmax)
PP<-Summarize(Pmax~species,GPpmax)
PT<-Summarize(Pmax~treatment,GPpmax)

PP%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
PT%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
#R
Summarize(Pmax~species*treatment,Rpmax)
PRs<-Summarize(Pmax~species,Rpmax)
PRt<-Summarize(Pmax~treatment,Rpmax)

PRs%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 

PT%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 


library(lattice)
#GP
histogram(~ Pmax | treatment, GPpmax) 
kruskal.test(Pmax~treatment, GPpmax) 
histogram(~ Pmax | species, GPpmax) 
kruskal.test(Pmax~species, GPpmax)  
histogram(~ Pmax | species*treatment, GPpmax) 
#R
histogram(~ Pmax | treatment, Rpmax) 
kruskal.test(Pmax~treatment, Rpmax)
histogram(~ Pmax | species, Rpmax) 
kruskal.test(Pmax~species, Rpmax) 
histogram(~ Pmax | species*treatment, Rpmax) 


### Pmax Species

# Create a model to plot
P.mod <- lm(Pmax~species,GPpmax)
summary(P.mod)
#lm(formula = Pmax ~ species, data = GPpmax)
#
#Residuals:
#      Min        1Q    Median        3Q       Max 
#-0.077645 -0.025015 -0.000096  0.030386  0.066823 
#
#Coefficients:
#            Estimate Std. Error t value Pr(>|t|)    
#(Intercept)  1.24208    0.01985  62.566  < 2e-16 ***
#speciesMCAV -0.35395    0.02808 -12.607 2.20e-09 ***
#speciesOFRA -0.06567    0.02688  -2.443   0.0274 *  
#speciesPAST -0.26635    0.03242  -8.216 6.19e-07 ***

summ(P.mod, confint = TRUE, digits = 3)
effect_plot(P.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(P.mod)
plot_summs(P.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(P.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)



export_summs(P.mod, scale = TRUE)

coefPS <- as.data.frame(summary(P.mod)$coefficients[-1,1:2])
names(coefPS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefPS$vars = coral

PS<-ggplot(coefPS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("log")+
  xlab("")+
  ggtitle('Pmax')
 
PS

# kruskal plot
histogram(~ Pmax | species,GPpmax)     #  columns and rows of individual plots
          
## Species with Kruskal test
 Pmax.modk<- kruskal.test(Pmax~species,GPpmax) 
boxplot(Pmax~species,GPpmax)
#Post hoc Dunn test- describes Which variables have sign diifference 
#Dunn (1964) Kruskal-Wallis multiple comparison
 # p-values adjusted with the Holm method.
DT<-dunnTest(Pmax~species,GPpmax,method="holm")
DT


#DT<-dunnTest(Pmax~species,testGP,method="bonferroni")
#DT
PT = DT$res
PT
cldList(P.adj ~ Comparison,
        data = PT,
        threshold = 0.05)

#Group Letter MonoLetter
#1  DLAB      a        a  
#2  MCAV      b         b 
#3  OFRA     a          a 
#4  PAST     ab         ab
#Groups sharing a letter not signficantly different (alpha = 0.05).

Sum = groupwiseMedian(Pmax~species,GPpmax,conf= 0.95,R= 5000,percentile = TRUE,bca= FALSE,digits = 4)
Sum

X= 1:4
Y = Sum$Percentile.upper + 0.2
Label = c("a", "b", "ac", "bc")


ggplot(Sum,                ### The data frame to use.
       aes(x = species,
           y = Median)) +
    geom_errorbar(aes(ymin = Percentile.lower,
                     ymax = Percentile.upper),
                     width = 0.09,
                     size  = 1,colour="blue") +
  geom_point(size=2, pch=21, fill="yellow")+
     theme_classic() +
   theme(axis.title   = element_text()) +

   ylab("Median Likert score") +
  xlab("")+
  ggtitle("A) Pmax")+
annotate("text",
         x = X,
         y = Y,
         label = Label)


#Pmax treatment GP
P.modT <- lm(Pmax~treatment,GPpmax)
coefPT <- as.data.frame(summary(P.modT)$coefficients)
coefPT
names(coefPT)[2] = "se" 
coral <- c(treatmentshallow="")
coefPT$vars = coral
coefPT<-coefPT[-1,]

PT<-ggplot(coefPT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('Pmax')
PT
#graph2ppt(file="Pmax_treat plot.pptx", width=7, height=5)


Pmaxspp3<-ggplot(GPpmax, aes(x=species, Pmax, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
   theme_classic()+
  ylim(0.8,1.3)+
  xlab(NULL)+
 ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  ggtitle("Pmax")+
  stat_compare_means(label.x= "MCAV", label.y=1.3, method = "anova")+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

Pmaxspp3

#Coefficent plots with densities
summ(P.modT, confint = TRUE, digits = 1)
effect_plot(P.modT, pred = treatment, interval = TRUE, plot.points = TRUE)
plot_summs(P.modT)
plot_summs(P.modT, scale = TRUE, inner_ci_level = .5)
plot_summs(P.modT, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)


#library(huxtable)
export_summs(P.mod, scale = TRUE)

### R

### Pmax Species

# Create a model to plot
P.mod <- lm(Pmax~species,Rpmax)
summary(P.mod)
summ(P.mod, confint = TRUE, digits = 3)
effect_plot(P.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(P.mod)
plot_summs(P.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(P.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)

export_summs(P.mod, scale = TRUE)

coefPS <- as.data.frame(summary(P.mod)$coefficients[-1,1:2])
names(coefPS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefPS$vars = coral

PS<-ggplot(coefPS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("log")+
  xlab("")+
  ggtitle('Pmax_ R')
 
PS

# kruskal plot
histogram(~ Pmax | species,Rpmax)     #  columns and rows of individual plots
          
## Species with Kruskal test
 Pmax.modk<- kruskal.test(Pmax~species,Rpmax) 
boxplot(Pmax~species,Rpmax)
#Post hoc Dunn test- describes Which variables have sign diifference 
#Dunn (1964) Kruskal-Wallis multiple comparison
 # p-values adjusted with the Holm method.
DT<-dunnTest(Pmax~species,Rpmax,method="holm")
DT

PT = DT$res
PT

cldList(P.adj ~ Comparison,
        data = PT,
        threshold = 0.05)

#Group Letter MonoLetter
#1  DLAB      ab        ab  
#2  MCAV      a        a 
#3  OFRA     b        b 
#4  PAST     a         a
#Groups sharing a letter not signficantly different (alpha = 0.05).

Sum = groupwiseMedian(Pmax~species,Rpmax,conf= 0.95,R= 5000,percentile = TRUE,bca= FALSE,digits = 4)
Sum

X= 1:4
Y = Sum$Percentile.upper + 0.2
Label = ("a")


ggplot(Sum,                ### The data frame to use.
       aes(x = species,
           y = Median)) +
    geom_errorbar(aes(ymin = Percentile.lower,
                     ymax = Percentile.upper),
                     width = 0.09,
                     size  = 1,colour="blue") +
  geom_point(size=2, pch=21, fill="yellow")+
     theme_classic() +
   theme(axis.title   = element_text()) +

   ylab("Median Likert score") +
  xlab("")+
  ggtitle("B) Pmax (R)")+
annotate("text",
         x = X,
         y = Y,
         label = Label)

### treatment
P.modRT <- lm(Pmax~treatment,Rpmax)
coefPT <- as.data.frame(summary(P.modRT)$coefficients)
coefPT
names(coefPT)[2] = "se" 
coral <- c(treatmentshallow="")
coefPT$vars = coral
coefPT<-coefPT[-1,]

RPT<-ggplot(coefPT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('Pmax_R')
RPT

## Final Graphs

Pmaxspp3<-ggplot(GPpmax, aes(x=species, Pmax, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Maximum Rate of Performance (GP)")
  

Pmaxspp3+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

sppPmax<- ggplot(GPpmax, aes(x=species, Pmax, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0.5,1.5)+
  xlab(NULL)+
  ylab('Pmax (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=1.5, method = "anova")+scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))
 
  sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)


Pmaxsppr<-ggplot(Rpmax, aes(x=species, Pmax, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Maximum Rate of Performance (R)")
  

Pmaxsppr+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

######
sppPmax<- ggplot(GPlnc, aes(x=species,lnc, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,3)+
  xlab(NULL)+
  ylab('lnc (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=2.5, method = "anova")+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

 
  sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)



```

# Topt

```{r}

#### Topt
# remove zeros from Repiration and GP data frames 
# 
Ropt<-testR%>%filter(topt_C>0)# removed r topt_c's below zero- 3 ML2, MA3, MF1 (-273)

testopt<-testGP%>%
  filter(topt_C>0)# removed r topt_c's below zero
#GP ML1(-273)
#

#### Topt
#### Test for significant GP
mPGPsp<-aov(topt_C~species,testopt)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#5 13
#GP outlier= 5 and 13 testopt
GPopt<-testopt[-c(5,13),]

#### Test for significant R
mPGPsp<-aov(topt_C~species,Ropt)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 3*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>3*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# R outlier=2
Ropt<-Ropt[-(2),]

### ANOVAs for Topt GP and R
mPGPsp<-aov(topt_C~treatment,GPopt)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

mPGPsp<-aov(topt_C~species,GPopt)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(topt_C~species,GPopt)

mPGPsp<-aov(topt_C~species*treatment,GPopt)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals)

#R--- identifying variation in Topt from data in respiration
mPGPsp<-aov(topt_C~fragment.ID2,GPopt)
TukeyHSD(mPGPsp)
summary(mPGPsp)

ToptsppR<-ggplot(GPopt,aes(x=fragment.ID2, topt_C, colour=treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(shape=treatment, group= treatment), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape=NA)))+
  theme_classic()+
  xlab("")+
  ylab("Temperature (ºC)")+ scale_color_manual(values= c("#0000FF","#99CCFF"))+theme(legend.position = "none")+
  ggtitle("Topt_GP_frag")

ToptsppR

#### Respiration
#### 
ToptsppR<-ggplot(Ropt,aes(x=genotype, topt_C, colour=treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(shape=treatment, group= treatment), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape=NA)))+
  theme_classic()+
  xlab("")+
  ylab("Temperature (ºC)")+ scale_color_manual(values= c("#0000FF","#99CCFF"))+theme(legend.position = "none")+
  ggtitle("Topt_Res_frag")

ToptsppR

# Mesophpotic MCAV has a VERY low (10C Topt)
#  Data is very spread

#write.csv(Ropt,"C:/Github/TPC_BDA_github/R_scripts/manuscript/Ropt.csv")

mPGPsp<-aov(topt_C~treatment,Ropt)
TukeyHSD(mPGPsp)
summary(mPGPsp)
 #Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(topt_C~treatment, Ropt)

ToptsppR<-ggplot(Ropt,aes(x=treatment, topt_C, colour=treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(shape=species, group= treatment), position = position_jitterdodge(jitter.width = 0.5, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape=NA)))+
  theme_classic()+
  xlab("")+
  ylab("Temperature (ºC)")+ scale_color_manual(values= c("blue", "red"))#+theme(legend.position = "none")

ToptsppR

#### Species
mPGPsp<-aov(topt_C~species,Ropt)
TukeyHSD(mPGPsp)
summary(mPGPsp)
# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


ToptsppR<-ggplot(Ropt,aes(x=species, topt_C, colour=treatment))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(shape=treatment, group= treatment), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape=NA)))+
  theme_classic()+
  xlab("")+
  ylab("Temperature (ºC)")+ scale_color_manual(values= c("#0000FF","#99CCFF"))+theme(legend.position = "none")

ToptsppR

leveneTest(topt~species, Ropt) 
kruskal.test(topt~species,Ropt)
dunnTest(topt~species,Ropt)


leveneTest(topt~treatment, Ropt) 
kruskal.test(topt~treatment,Ropt)


mPGPsp<-aov(topt_C~species*treatment,Ropt)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
######################################################### CONTINUE PARA OUTLIERS ONLY HERE 1/30/2020
######################################################### 
#levene's test
##GP
leveneTest(topt_C~treatment, data=GPopt) 
leveneTest(topt_C~species, data=GPopt)  
leveneTest(topt_C~species*treatment, data=GPopt) 
#R
leveneTest(topt_C~treatment, Ropt) 
leveneTest(topt_C~species, Ropt)  
leveneTest(topt_C~species*treatment, Ropt) 


#GP
Summarize(topt_C~species*treatment,GPopt)
GTS<-Summarize(topt_C~species,GPopt)
GTT<-Summarize(topt_C~treatment,GPopt)
GTS%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Topt Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
GTT%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Topt Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)
#R
Summarize(topt_C~species*treatment,Ropt)
TS<-Summarize(topt_C~species,Ropt)
TT<-Summarize(topt_C~treatment,Ropt)
TS%>% 
    # Add a title
  kableExtra::kable(caption=" Means Topt Respiration") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
TT%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Topt Respiration") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)


#GP
histogram(~ topt_C | treatment, GPopt) 
kruskal.test(topt_C~treatment, GPopt) 
histogram(~ topt_C | species, GPopt) 
kruskal.test(topt_C~species, GPopt)  
histogram(~ topt_C | species*treatment, GPopt) 
#R
histogram(~ topt_C | treatment, Ropt) 
kruskal.test(topt_C~treatment, Ropt) 
histogram(~ topt_C | species, Ropt) 
kruskal.test(topt_C~species, Ropt) 
histogram(~ topt_C | species*treatment, Ropt) 

###### Linear Model 
T.modT <- lm(topt_C~treatment,GPopt)

summ(T.modT, confint = TRUE, digits = 1)
effect_plot(T.modT, pred = treatment, interval = TRUE, plot.points = TRUE)
plot_summs(T.modT)
plot_summs(T.modT, scale = TRUE, inner_ci_level = .5)
plot_summs(T.modT, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(T.modT, scale = TRUE)


coefTS <- as.data.frame(summary(T.modT)$coefficients)
coefTS
names(coefTS)[2] = "se" 
coral <- c(treatmentshallow="")
coefTS$vars = coral
coefTS<-coefTS[-1,]

TS<-ggplot(coefTS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Topt GP')
TS


## Species
T.mod <- lm(topt_C~species,GPopt)
summ(T.mod, confint = TRUE, digits = 3)
effect_plot(T.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(T.mod)
plot_summs(T.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(T.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(T.mod, scale = TRUE)

summary(T.mod)
coefTT <- as.data.frame(summary(T.mod)$coefficients[-1,1:2])
names(coefTT)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefTT$vars = coral

TT<-ggplot(coefTT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Topt GP')
 TT

#R
RT.modT <- lm(topt_C~treatment,Ropt)
coefTS <- as.data.frame(summary(RT.modT)$coefficients)
coefTS
names(coefTS)[2] = "se" 
coral <- c(treatmentshallow="")
coefTS$vars = coral
coefTS<-coefTS[-1,]

RTS<-ggplot(coefTS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Topt R')
RTS

T.mod <- lm(topt_C~species,Ropt)
summary(T.mod)
coefTT <- as.data.frame(summary(T.mod)$coefficients[-1,1:2])
names(coefTT)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefTT$vars = coral

TT<-ggplot(coefTT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Topt R')
 TT

## Final Graphs

Pmaxspp3<-ggplot(GPopt, aes(x=species, topt_C, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Topt(GP)")
  

Pmaxspp3+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))


Pmaxsppr<-ggplot(Ropt, aes(x=species, topt_C, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Topt (R)")+
  facet_wrap(~treatment)
  

Pmaxsppr+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

```

#E

```{r}
## E

#### 
#### E
#### Test for significant GP in E
mPGPsp<-aov(E~species,testGP)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 10= 51 E( ML1) 
#GP outlier= 10 and 13 testopt
GPE<-testGP[-c(15,19),]

#R
#### Test for significant R in E
mPGPsp<-aov(E~treatment,R2)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.Adjusted to 1 to obtain all Outliers in parameter data 
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 10 
#10	ML	DLAB	ML1	R	deep	41.85094439	4

RE<-R2[-(4),]

# GP
mPGPsp<-aov(E~treatment,GPE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(E~treatment, GPE) 



mPGPsp<-aov(E~species,GPE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp)
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(E~species, GPE) 
 
mPGPsp<-aov(E~species*treatment,GPE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


#R
mPGPsp<-aov(E~treatment,RE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(E~treatment,RE)

leveneTest(E~treatment, RE) 

### log parameter E- failed shapiro and levenes test 
RE$log.E <- log(RE$E+ 1) 

mPGPsp<-aov(log.E~treatment,RE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(E~treatment,RE)

#####################
mPGPsp<-aov(E~species,RE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


kruskal.test(E~species,RE)
 
mPGPsp<-aov(E~species*treatment,RE)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


#levene's test
##GP
leveneTest(E~treatment, data=GPE)
leveneTest(E~species, data=GPE)  
leveneTest(E~species*treatment, data=GPE) 
#R
leveneTest(E~treatment, RE) 
leveneTest(E~species, RE)  
leveneTest(E~species*treatment, RE) 

#GP
Summarize(E~species*treatment,GPE)
EEs<-Summarize(E~species,GPE)
EET<-Summarize(E~treatment,GPE)
EEs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean E Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
EET%>% 
    # Add a title
  kableExtra::kable(caption=" Mean E Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)

#R
Summarize(E~species*treatment,RE)
REs<-Summarize(E~species,RE)
REt<-Summarize(log.E~treatment,RE)
REs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean E Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
REt%>% 
    # Add a title
  kableExtra::kable(caption=" Mean E Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)



#GP
histogram(~ E | treatment, GPE) 
kruskal.test(E~treatment, GPE) 
histogram(~ E | species, GPE) 
kruskal.test(E~species, GPE)  
histogram(~ E | species*treatment, GPE) 
#

histogram(~ log.E | treatment, RE) 
kruskal.test(log.E~treatment, RE) 
histogram(~ E | species, RE) 
kruskal.test(E~species, RE) 
histogram(~ E | species*treatment, RE) 

E.modT <- lm(E~treatment,GPE)
summ(E.modT, confint = TRUE, digits = 1)
effect_plot(E.modT, pred = treatment, interval = TRUE, plot.points = TRUE)
plot_summs(E.modT)
plot_summs(E.modT, scale = TRUE, inner_ci_level = .5)
plot_summs(E.modT, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(E.modT, scale = TRUE)


coefET <- as.data.frame(summary(E.modT)$coefficients)
coefET
names(coefET)[2] = "se" 
coral<- c(treatmentshallow="")
coefET$vars = coral
coefET<-coefET[-1,]

ET<-ggplot(coefET, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('E')
ET


## Species
E.mod <- lm(E~species,GPE)

summ(E.mod, confint = TRUE, digits = 3)
effect_plot(E.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(E.mod)
plot_summs(E.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(E.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(E.mod, scale = TRUE)

coefES <- as.data.frame(summary(E.mod)$coefficients[-1,1:2])
names(coefES)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefES$vars = coral

ES<-ggplot(coefES, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=2, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('E')
ES 



#R
ER.modT <- lm(log.E~treatment,RE)
summ(ER.modT, confint = TRUE, digits = 1)
effect_plot(ER.modT, pred = treatment, interval = TRUE, plot.points = TRUE)
plot_summs(ER.modT)
plot_summs(ER.modT, scale = TRUE, inner_ci_level = .5)
plot_summs(ER.modT, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(ER.modT, scale = TRUE)


coefET <- as.data.frame(summary(ER.modT)$coefficients)
coefET
names(coefET)[2] = "se" 
coral<- c(treatmentshallow="")
coefET$vars = coral
coefET<-coefET[-1,]

RET<-ggplot(coefET, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('log E')
RET

## Species
E.mod <- lm(E~species,RE)

summ(E.mod, confint = TRUE, digits = 3)
effect_plot(E.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(E.mod)
plot_summs(E.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(E.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(E.mod, scale = TRUE)

coefES <- as.data.frame(summary(E.mod)$coefficients[-1,1:2])
names(coefES)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefES$vars = coral

ES<-ggplot(coefES, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=2, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('E')
ES 

## Final Graphs

Espp<-ggplot(GPE, aes(x=species, E, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("E (GP)")+
   facet_wrap(~treatment)

Espp+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))



EsppR<-ggplot(RE, aes(x=species, E, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("E (R)")+
  facet_wrap(~treatment)
  

EsppR+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

sppPmax<- ggplot(RE, aes(x=treatment, log.E))+
     stat_summary(fun.y=mean, geom="point")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,6)+
  xlab(NULL)+
  ylab('log E (R)')+
  ggtitle("")+
  stat_compare_means(label.x= "deep", label.y=6, method = "anova")
 sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)
 
 sppPmax<- ggplot(RE, aes(x=treatment, log.E, colour= treatment))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=species), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,5)+
  xlab(NULL)+
  ylab('log E (R)')+
  ggtitle("")+
  stat_compare_means(label.x= "deep", label.y=5, method = "anova")+scale_color_manual(breaks = c("deep", "shallow"), values= c("blue","red"))
 
  sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)

                                                                                                            

```

# Eh

```{r}

## Eh

#### 
#### E
#### Test for significant GP in Eh
mPGPsp<-aov(Eh~species,testGP)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

#  5 MC2
GPEh<-testGP[-(5),]

mPGPsp<-aov(Eh~treatment,GPEh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

#R
#### Test for significant R in E
mPGPsp<-aov(Eh~treatment,testR)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.Adjusted to 1 to obtain all Outliers in parameter data 
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#####

## Eh
## 5,10
REh<-testR[-c( 5),]


#GP
mPGPsp<-aov(Eh~treatment,GPEh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(Eh~treatment,GPEh)

mPGPsp<-aov(Eh~species,GPEh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
kruskal.test(Eh~species,GPEh)

 
mPGPsp<-aov(Eh~species*treatment,GPEh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


#R
mPGPsp<-aov(Eh~treatment,REh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(Eh~treatment,REh)

mPGPsp<-aov(Eh~species,REh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(Eh~species,REh) 


mPGPsp<-aov(Eh~species*treatment,REh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

#levene's test
##GP
leveneTest(Eh~treatment, data=GPEh) 
leveneTest(Eh~species, data=GPEh)  
leveneTest(Eh~species*treatment, data=GPEh) 
#R
leveneTest(Eh~treatment, REh) 
leveneTest(Eh~species, REh)
leveneTest(Eh~species*treatment, REh) 

#GP
Summarize(Eh~species*treatment,GPEh)
EEHs<-Summarize(Eh~species,GPEh)
EEHT<-Summarize(Eh~treatment,GPEh)
EEHs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Eh Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
EEHT%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Eh Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)


#R
Summarize(Eh~species*treatment,REh)
Rehs<-Summarize(Eh~species,REh)
Reht<-Summarize(Eh~treatment,REh)
Rehs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Eh Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
Reht%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Eh Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)


#GP
histogram(~ Eh | treatment, GPEh) 
kruskal.test(Eh~treatment, GPEh) 
histogram(~ Eh | species, GPEh) 
kruskal.test(Eh~species, GPEh)  
histogram(~ Eh | species*treatment, GPEh) 
#

histogram(~ Eh | treatment, REh) 
kruskal.test(Eh~treatment, REh) 
histogram(~ Eh | species, REh) 
kruskal.test(Eh~species, REh) 
histogram(~ Eh | species*treatment, REh) 

Eh.modT <- lm(Eh~treatment,GPEh)
coefEHT <- as.data.frame(summary(Eh.modT)$coefficients)
coefEHT
names(coefEHT)[2] = "se" 
coral <- c(treatmentshallow="")
coefEHT$vars = coral
coefEHT<-coefEHT[-1,]

EHT<-ggplot(coefEHT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('Eh')
EHT


## Species
Eh.mod <- lm(Eh~species,GPEh)
coefEHS <- as.data.frame(summary(Eh.mod)$coefficients[-1,1:2])
names(coefEHS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefEHS$vars = coral

EHS<-ggplot(coefEHS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('Eh')
EHS 


#R
REh.modT <- lm(Eh~treatment,REh)
coefEHT <- as.data.frame(summary(REh.modT)$coefficients)
coefEHT
names(coefEHT)[2] = "se" 
coral <- c(treatmentshallow="")
coefEHT$vars = coral
coefEHT<-coefEHT[-1,]

REHT<-ggplot(coefEHT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('Eh')
REHT

## Species
REh.mod <- lm(E~species,REh)
coefES <- as.data.frame(summary(REh.mod)$coefficients[-1,1:2])
names(coefES)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefES$vars = coral

ES<-ggplot(coefES, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Energy")+
  xlab("")+
  ggtitle('Eh')
ES 

## Final Graphs

Espp<-ggplot(GPEh, aes(x=species, Eh, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Eh (GP)")

Espp+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))


EsppR<-ggplot(REh, aes(x=species, Eh, colour= species))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Eh (R)")+
  facet_wrap(~treatment)
  

EsppR+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

```

# Th

```{r}

## Th
#### 
#### Th
#### Test for significant GP in Th
mPGPsp<-aov(Th~species,testGP)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 15, 22

GPTh<-testGP[-c(15, 19, 22),]

#R
#### Test for significant R in Th
mPGPsp<-aov(Th~species,testR)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.Adjusted to 1 to obtain all Outliers in parameter data 
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#####

## Th 3
RTh<-testR[-( 3),]
######
#GP
mPGPsp<-aov(Th_C~treatment,GPTh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(Th_C~treatment,GPTh)

mPGPsp<-aov(Th_C~species,GPTh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(Th_C~species,GPTh)
 
mPGPsp<-aov(Th_C~species*treatment,GPTh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


RTh<-RTh%>%
  filter(Th_C<44) # removed Obvious oulier > 100C
#R
mPGPsp<-aov(Th_C~treatment,RTh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(Th_C~treatment,RTh)

mPGPsp<-aov(Th_C~species,RTh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

 
mPGPsp<-aov(Th_C~species*treatment,RTh)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

#levene's test
##GP
leveneTest(Th_C~treatment, data=GPTh) 
leveneTest(Th_C~species, data=GPTh)  
leveneTest(Th_C~species*treatment, data=GPTh) 
#R
leveneTest(Th_C~treatment, RTh) 
leveneTest(Th_C~species, RTh)
leveneTest(Th_C~species*treatment, RTh) 

#GP
Summarize(Th_C~species*treatment,GPTh)
ThSs<-Summarize(Th_C~species,GPTh)
ThSt<-Summarize(Th_C~treatment,GPTh)
ThSs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Th Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
EEHT%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Th Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)
#R
Summarize(Th_C~species*treatment,RTh)
Rthcs<-Summarize(Th_C~species,RTh)
Rthct<-Summarize(Th_C~treatment,RTh)
Rthcs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Th Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
Rthct%>% 
    # Add a title
  kableExtra::kable(caption=" Mean Th Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)



#GP
histogram(~ Th_C | treatment, GPTh) 
kruskal.test(Th_C~treatment, GPTh) 
histogram(~ Th_C | species, GPTh) 
kruskal.test(Th_C~species, GPTh)  
histogram(~ Th_C | species*treatment, GPTh) 
#

histogram(~ Th_C | treatment, RTh) 
kruskal.test(Th_C~treatment, RTh) 
histogram(~ Th_C | species, RTh) 
kruskal.test(Th_C~species, RTh) 
histogram(~ Th_C | species*treatment, RTh) 

Th.modT <- lm(Th_C~treatment,GPTh)
coefTHT <- as.data.frame(summary(Th.modT)$coefficients)
coefTHT
names(coefTHT)[2] = "se" 
coral <- c(treatmentshallow="")
coefTHT$vars = coral
coefTHT<-coefTHT[-1,]

THT<-ggplot(coefTHT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=3, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Th (GP)')
THT


## Species
Th.mod <- lm(Th_C~species,GPTh)
summ(Th.mod, confint = TRUE, digits = 3)
effect_plot(Th.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(Th.mod)
plot_summs(Th.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(Th.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(Th.mod, scale = TRUE)

coefTHS <- as.data.frame(summary(Th.mod)$coefficients[-1,1:2])
names(coefTHS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefTHS$vars = coral

THS<-ggplot(coefTHS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Th')
THS 

#R
RTh.modT <- lm(Th_C~treatment,RTh)
coefTHT <- as.data.frame(summary(RTh.modT)$coefficients)
coefTHT
names(coefTHT)[2] = "se" 
coral <- c(treatmentshallow="")
coefTHT$vars = coral
coefTHT<-coefTHT[-1,]


RTHT<-ggplot(coefTHT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Th')
RTHT

## Species
Th.mod <- lm(Th_C~species,RTh)
coefTHS <- as.data.frame(summary(Th.mod)$coefficients[-1,1:2])
names(coefTHS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefTHS$vars = coral

THS<-ggplot(coefTHS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab("Temperature (ºC)")+
  xlab("")+
  ggtitle('Th')
THS 

## Final Graphs

Espp<-ggplot(GPTh, aes(x=species, Th_C, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Th (GP)")

Espp+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))


EsppR<-ggplot(RTh, aes(x=species, Th_C, colour= species))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("Th (R)")+
  facet_wrap(~treatment)
  

EsppR+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))


sppPmax<- ggplot(GPTh, aes(x=species, Th_C, color="species"))+
     stat_summary(fun.y=mean, geom="point")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(25,40)+
  xlab(NULL)+
  ylab('Th (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=40, method = "anova")

 sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)
 
 sppPmax<- ggplot(GPTh, aes(x=species,Th_C, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(25,40)+
  xlab(NULL)+
  ylab('Th (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=40, method = "anova")+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

 
  sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)

```


# lnc

```{r}

## lnc

#### 
#### Test for significant GP in Th
mPGPsp<-aov(lnc~species,testGP)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")

# 15

GPlnc<-testGP[-(15),]

#R
#### Test for significant R in Th
mPGPsp<-aov(lnc~species,testR)
TukeyHSD(mPGPsp)
summary(mPGPsp)

cooksd <- cooks.distance(mPGPsp)
plot(cooksd, pch=".", cex=2, main="Influential Obs by Cooks distance")  # plot cook's distance
abline(h = 4*mean(cooksd, na.rm=TRUE), col="red")  # add cutoff line--In general use, those observations that have a cook’s distance greater than 4 times the mean may be classified as influential. This is not a hard boundary.Adjusted to 1 to obtain all Outliers in parameter data 
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4*mean(cooksd, na.rm=TRUE),names(cooksd),""), cex=0.6, pos=2, col="red")
#####

## Th 10
Rlnc<-testR[-(15),]

###
#GP
mPGPsp<-aov(lnc~treatment,GPlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(lnc~treatment,GPlnc) 


mPGPsp<-aov(lnc~species,GPlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )
leveneTest(lnc~species, data=GPlnc)

kruskal.test(lnc~species,GPlnc) 

### log parameter lnc- failed shapiro a
GPlnc$log.lnc <- log(GPlnc$lnc+1) 

mPGPsp<-aov(log.lnc~species,GPlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(log.lnc~species, GPlnc)

leveneTest(log.lnc~species, data=GPlnc)  


mPGPsp<-aov(lnc~species*treatment,GPlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

#R
mPGPsp<-aov(lnc~treatment,Rlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )


kruskal.test(lnc~treatment,Rlnc)


mPGPsp<-aov(lnc~species,Rlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )

kruskal.test(lnc~species,Rlnc)

mPGPsp<-aov(lnc~species*treatment,Rlnc)
TukeyHSD(mPGPsp)
summary(mPGPsp)

# Extract the residuals
aov_residuals <- residuals(object = mPGPsp )
# Run Shapiro-Wilk test
shapiro.test(x = aov_residuals )



#levene's test
##GP
leveneTest(lnc~treatment, data=GPlnc) 
leveneTest(lnc~species, data=GPlnc)  
leveneTest(lnc~species*treatment, data=GPlnc) 
#R
leveneTest(lnc~treatment, Rlnc) 
leveneTest(lnc~species, Rlnc)
leveneTest(lnc~species*treatment, Rlnc) 

#GP
Summarize(lnc~species*treatment,GPlnc)
lncSs<-Summarize(lnc~species,GPlnc)
lncSt<-Summarize(lnc~treatment,GPlnc)
lncSs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean lnc Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
lncSt%>% 
    # Add a title
  kableExtra::kable(caption=" Mean lnc Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)

#R
Summarize(lnc~species*treatment,Rlnc)
Rlncs<-Summarize(lnc~species,Rlnc)
RlncT<-Summarize(lnc~treatment,Rlnc)
Rlncs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean lnc Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 
RlncT%>% 
    # Add a title
  kableExtra::kable(caption=" Mean lnc Respiration ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)



#GP
histogram(~ lnc | treatment, GPlnc) 
kruskal.test(lnc~treatment, GPlnc) 
histogram(~ lnc | species, GPlnc) 
kruskal.test(lnc~species, GPlnc)  
histogram(~ lnc | species*treatment, GPlnc) 
#


histogram(~ lnc | treatment, Rlnc) 
kruskal.test(lnc~treatment, Rlnc) 
histogram(~ lnc | species, Rlnc) 
kruskal.test(lnc~species, Rlnc) 
histogram(~ lnc | species*treatment, Rlnc) 

lnc.modT <- lm(lnc~treatment,GPlnc)
coeflncT <- as.data.frame(summary(lnc.modT)$coefficients)
coeflncT
names(coeflncT)[2] = "se" 
coral <- c(treatmentshallow="")
coeflncT$vars = coral
coeflncT<-coeflncT[-1,]

lncT<-ggplot(coeflncT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
 ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('lnc')

lncT

### species with linear model
 lnc.mod <- lm(lnc~species,GPlnc)
 summ(lnc.mod, confint = TRUE, digits = 3)
effect_plot(lnc.mod, pred = species, interval = TRUE, plot.points = TRUE)
plot_summs(lnc.mod)
plot_summs(lnc.mod, scale = TRUE, inner_ci_level = .5)
plot_summs(lnc.mod, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(lnc.mod, scale = TRUE)

summary(lnc.mod)
anova(lnc.mod)
coefslncS <- as.data.frame(summary(lnc.mod)$coefficients[-1,1:2])
names(coefslncS)[2] = "se" 
coral <- c(speciesMCAV="MCAV", speciesOFRA="OFRA",speciesPAST="PAST")
coefslncS$vars = coral

lncs<-ggplot(coefslncS, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
  ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('lnc')
lncs 



#R
Rlnc.modT <- lm(lnc~treatment,Rlnc)

summ(Rlnc.modT, confint = TRUE, digits = 1)
effect_plot(Rlnc.modT, pred = treatment, interval = TRUE, plot.points = TRUE)
plot_summs(Rlnc.modT)
plot_summs(Rlnc.modT, scale = TRUE, inner_ci_level = .5)
plot_summs(Rlnc.modT, scale = TRUE, plot.distributions = TRUE, inner_ci_level = .5)
export_summs(Rlnc.modT, scale = TRUE)

coeflncT <- as.data.frame(summary(Rlnc.modT)$coefficients)
coeflncT
names(coeflncT)[2] = "se" 
coral <- c(treatmentshallow="")
coeflncT$vars = coral
coeflncT<-coeflncT[-1,]

RlncT<-ggplot(coeflncT, aes(vars, Estimate)) + 
  geom_hline(yintercept=0, lty=2, lwd=1, colour="grey50") +
  geom_errorbar(aes(ymin=Estimate - 1.96*se, ymax=Estimate + 1.96*se),
                lwd=1, colour="red", width=0) +
  geom_errorbar(aes(ymin=Estimate - se, ymax=Estimate + se), 
                lwd=2.5, colour="blue", width=0) +
  geom_point(size=5, pch=21, fill="yellow") +
  theme_bw()+
  coord_flip()+
 ylab(expression(paste("log ", mu,"mol cm"^{-2}, "hr"^{-1})))+
  xlab("")+
  ggtitle('lnc')

RlncT



histogram(~ lnc | species,GPlnc)     #  columns and rows of individual plots
          
## Species with Kruskal test
 lnc.modk<- kruskal.test(lnc~species,GPlnc) 
 summary(lnc.modk)
 boxplot(lnc~species,GPlnc)
#Post hoc Dunn test- describes Which variables have sign diifference 
#Dunn (1964) Kruskal-Wallis multiple comparison
 # p-values adjusted with the Holm method.
#DT<-dunnTest(lnc~species,GPlnc,method="bh")
#DT
DT<-dunnTest(lnc~species,GPlnc,method="holm")
DT
PT = DT$res
PT

cldList(P.adj ~ Comparison,
        data = PT,
        threshold = 0.05)

#
#Because the post-hoc test will produce multiple p-values, #adjustments to the p-values can be made to avoid inflating #the possibility of making a type-I error.  There are a #variety of methods for controlling the familywise error #rate or for controlling the false discovery rate.  See #?p.adjust for details on these methods.
#
# 
#
#When there are many p-values to evaluate, it is useful to #condense a table of p-values to a compact letter display #format.  In the output, groups are separated by letters.  #Groups sharing the same letter are not significantly #different.  Compact letter displays are a clear and #succinct way to present results of multiple comparisons.
# Group Letter MonoLetter
#1  DLAB      a         a 
#2  MCAV      b          b
#3  OFRA      ab         ab 
#4  PAST     ab         ab
#Groups sharing a letter not signficantly different (alpha = 0.05).

Sum = groupwiseMedian(lnc~species,GPlnc,conf= 0.95,R= 5000,percentile = TRUE,bca= FALSE,digits = 4)
Sum
Sum%>% 
    # Add a title
  kableExtra::kable(caption=" Means Pmax Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)


X= 1:4
Y = Sum$Percentile.upper + 0.2
Label = c("a", "b", "a", "ab")


ggplot(Sum,                ### The data frame to use.
       aes(x = species,
           y = Median)) +
    geom_errorbar(aes(ymin = Percentile.lower,
                     ymax = Percentile.upper),
                     width = 0.09,
                     size  = 1,colour="blue") +
  geom_point(size=2, pch=21, fill="yellow")+
     theme_classic() +
   theme(axis.title   = element_text()) +

   ylab("Median Likert score") +
  xlab("")+
  ggtitle("B) lnc")+
annotate("text",
         x = X,
         y = Y,
         label = Label)

ggplot(Sum,                ### The data frame to use.
       aes(x = species,
           y = Median)) +
   geom_errorbar(aes(ymin = Percentile.lower,
                     ymax = Percentile.upper),
                     width = 0.09,
                     size  = 1,colour="blue") +
  geom_point(size=2, pch=21, fill="yellow")+
   theme_classic() +
   theme(axis.title   = element_text()) +

   ylab("Median Likert score") +
  xlab("")+
annotate("text",
         x = X,
         y = Y,
         label = Label)




## Final Graphs

lspp<-ggplot(GPlnc, aes(x=species, lnc, colour= species))+
  stat_boxplot(geom= "errorbar", width= 0.5, position = position_dodge(1))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment, group= fragment.ID2), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("lnc (GP)")+
   facet_wrap(~treatment)

lspp+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))


lsppR<-ggplot(Rlnc, aes(x=species, lnc, colour= species))+
  geom_boxplot(position = position_dodge(1))+
  geom_point(aes(fill= species, shape=treatment), position = position_jitterdodge(jitter.width = 0, jitter.height = 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  xlab("Species")+
  ylab("lnc (R)")
  

lsppR+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

 sppPmax<- ggplot(GPlnc, aes(x=species,lnc, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,3)+
  xlab(NULL)+
  ylab('lnc (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=2.5, method = "anova")+ scale_color_manual(breaks = c("DLAB", "MCAV", "OFRA", "PAST"), values= c("orange", "green", "purple", "blue"))

 
  sppPmax+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)
  
   
  
```

#kruskal wallis & anova significant tests

```{r}
#Plot of median Likert score versus #Speaker.  Error bars indicate the 95% #confidence intervals for the median #with the percentile 
#
library(ggpubr)

#Pmax spp
sppP<- ggplot(GPpmax, aes(x=species, Pmax, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0.75,1.35)+
  xlab(NULL)+
  ylab('Pmax')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=1.3, method = "kruskal.test")+
  scale_color_manual(breaks = c("DLAB", "MCAV","OFRA","PAST"), values= c("#4363d8","#3cb44b", "#911eb4","#f58231"))+ labs(shape= "Site", colour= "Species")+theme(legend.position = "bottom",
          legend.box = "vertical")
 
  sppP+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)

#Pmax spp
sppPR<- ggplot(Rpmax, aes(x=species, Pmax, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,1)+
  xlab(NULL)+
  ylab('Pmax')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=1, method = "kruskal.test")+
  scale_color_manual(breaks = c("DLAB", "MCAV","OFRA","PAST"), values= c("#4363d8","#3cb44b", "#911eb4","#f58231"))+ labs(shape= "Site", colour= "Species")+theme(legend.position = "bottom",
          legend.box = "vertical")
 
  sppPR+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)


  # topt respiration !treatment
#Topt spp
kruskal.test(topt_C~treatment, Ropt)

sppPRop<- ggplot(Ropt, aes(x=treatment, topt_C, colour= treatment))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=species), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(10,40)+
  xlab(NULL)+
  ylab('Topt (R)')+
  ggtitle("")+
  stat_compare_means(label.x= "shallow", label.y=15, method = "kruskal.test")
 
  sppPRop+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)

## E anova- GP 

sppE<- ggplot(GPE, aes(x=treatment, E, colour= treatment))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=species), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  ylim(0,2.75)+
  xlab(NULL)+
  ylab('E (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "deep", label.y=2, method = "anova")
 
  sppE+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)


  #GPTh	GP	Th	treatment anova
  
  
sppTh<- ggplot(GPTh, aes(x=treatment, Th_C, colour= treatment))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=species), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab('Th (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "deep", label.y=, method = "anova")
 
  sppTh+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)

#GP	lnc	species		kruskal 2.99E-02
  
  lncs<- ggplot(GPlnc, aes(x=species, lnc, colour= species))+
     stat_summary(fun.y=mean, geom="point", color="black")+
     geom_point(aes(shape=treatment), position = position_jitterdodge(jitter.width = 0,jitter.height= 0))+
  guides(fill= guide_legend(override.aes = list(shape= NA)))+
  theme_classic()+
  xlab(NULL)+
  ylab('lnc (GP)')+
  ggtitle("")+
  stat_compare_means(label.x= "MCAV", label.y=2, method = "kruskal.test")+
  scale_color_manual(breaks = c("DLAB", "MCAV","OFRA","PAST"), values= c("#4363d8","#3cb44b", "#911eb4","#f58231"))+ labs(shape= "Site", colour= "Species")+theme(legend.position = "bottom",
          legend.box = "vertical")
 
  lncs+stat_summary(fun.data = "mean_cl_boot", geom="errorbar", size = 0.5)

```

```{r}
depthP<-GPopt%>%
  filter(treatment=="deep")

depthP2<-GPopt%>%
  filter(treatment=="shallow")

Summarize(topt_C~species*treatment,depthP)
lncSs<-Summarize(topt_C~species,depthP)
lncSs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean topt Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F) 

Summarize(topt_C~species*treatment,depthP2)
lncSs<-Summarize(topt_C~species,depthP2)
lncSs%>% 
    # Add a title
  kableExtra::kable(caption=" Mean topt Gross Photosynthesis ") %>% 
    # Specify how we will see the table, type ?kablestyling to see explanations and options
  kable_styling(bootstrap_options = "condensed", full_width=F)

```


```{r}
## Function to calculate summary stats using 1 grouping variable only: 
summary_stats <- function(df, group_var, resp_var, ...){
  group_var <- enquo(group_var) #need to use standard evaluation, use this quoting mechanism
  resp_var <- enquo(resp_var)
 
  sum_tab <- as.data.frame(df %>%
    group_by(!! group_var) %>% # the !! is notation for standard evaluation
    summarise(n = n(), 
              mean = round(mean(!! resp_var, na.rm=TRUE),2), 
              sd = round(sd(!! resp_var, na.rm=TRUE),2),
              median = round(median(!! resp_var, na.rm=TRUE),2),
              min = round(min(!! resp_var, na.rm=TRUE),2),
              max = round(max(!! resp_var, na.rm=TRUE),2),
              range = round((max(!! resp_var, na.rm=TRUE)-min(!! resp_var, na.rm=TRUE)),2),
              IQR = round(IQR(!! resp_var, na.rm=TRUE),2)))
  return(sum_tab)
}


## Function to calculate summary stats when grouping by 2 variables:
summary_stats_2var <- function(df, group_var1, group_var2, resp_var, ...){ 
  group_var1 <- enquo(group_var1) #need to use standard evaluation, use this quoting mechanism
  group_var2 <- enquo(group_var2)
  resp_var <- enquo(resp_var)
 
  sum_tab <- as.data.frame(df %>%
    group_by(!! group_var1, !! group_var2) %>% # the !! is notation for standard evaluation
    summarise(n = n(), 
              mean = round(mean(!! resp_var, na.rm=TRUE),2), 
              sd = round(sd(!! resp_var, na.rm=TRUE),2),
              median = round(median(!! resp_var, na.rm=TRUE),2),
              min = round(min(!! resp_var, na.rm=TRUE),2),
              max = round(max(!! resp_var, na.rm=TRUE),2),
              range = round((max(!! resp_var, na.rm=TRUE)-min(!! resp_var, na.rm=TRUE)),2),
              IQR = round(IQR(!! resp_var, na.rm=TRUE),2)))
  return(sum_tab)
}
```

